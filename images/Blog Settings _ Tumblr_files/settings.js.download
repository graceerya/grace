/*! scripts/qrcode.js */
var qrcode=function(){function t(e,i){if("undefined"==typeof e.length)throw new Error(e.length+"/"+i);var o=function(){for(var t=0;t<e.length&&0==e[t];)t+=1;for(var o=new Array(e.length-t+i),s=0;s<e.length-t;s+=1)o[s]=e[s+t];return o}(),s={};return s.getAt=function(t){return o[t]},s.getLength=function(){return o.length},s.multiply=function(e){for(var i=new Array(s.getLength()+e.getLength()-1),o=0;o<s.getLength();o+=1)for(var n=0;n<e.getLength();n+=1)i[o+n]^=r.gexp(r.glog(s.getAt(o))+r.glog(e.getAt(n)));return t(i,0)},s.mod=function(e){if(s.getLength()-e.getLength()<0)return s;for(var i=r.glog(s.getAt(0))-r.glog(e.getAt(0)),o=new Array(s.getLength()),n=0;n<s.getLength();n+=1)o[n]=s.getAt(n);for(var n=0;n<e.getLength();n+=1)o[n]^=r.gexp(r.glog(e.getAt(n))+i);return t(o,0).mod(e)},s}var e=function(e,i){var s=236,r=17,h=e,c=o[i],u=null,d=0,m=null,g=new Array,f={},b=function(t,e){d=4*h+17,u=function(t){for(var e=new Array(t),i=0;i<t;i+=1){e[i]=new Array(t);for(var o=0;o<t;o+=1)e[i][o]=null}return e}(d),v(0,0),v(d-7,0),v(0,d-7),$(),k(),T(t,e),h>=7&&y(t),null==m&&(m=B(h,c,g)),x(m,e)},v=function(t,e){for(var i=-1;i<=7;i+=1)if(!(t+i<=-1||d<=t+i))for(var o=-1;o<=7;o+=1)e+o<=-1||d<=e+o||(0<=i&&i<=6&&(0==o||6==o)||0<=o&&o<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=o&&o<=4?u[t+i][e+o]=!0:u[t+i][e+o]=!1)},w=function(){for(var t=0,e=0,i=0;i<8;i+=1){b(!0,i);var o=n.getLostPoint(f);(0==i||t>o)&&(t=o,e=i)}return e},k=function(){for(var t=8;t<d-8;t+=1)null==u[t][6]&&(u[t][6]=t%2==0);for(var e=8;e<d-8;e+=1)null==u[6][e]&&(u[6][e]=e%2==0)},$=function(){for(var t=n.getPatternPosition(h),e=0;e<t.length;e+=1)for(var i=0;i<t.length;i+=1){var o=t[e],s=t[i];if(null==u[o][s])for(var r=-2;r<=2;r+=1)for(var a=-2;a<=2;a+=1)r==-2||2==r||a==-2||2==a||0==r&&0==a?u[o+r][s+a]=!0:u[o+r][s+a]=!1}},y=function(t){for(var e=n.getBCHTypeNumber(h),i=0;i<18;i+=1){var o=!t&&1==(e>>i&1);u[Math.floor(i/3)][i%3+d-8-3]=o}for(var i=0;i<18;i+=1){var o=!t&&1==(e>>i&1);u[i%3+d-8-3][Math.floor(i/3)]=o}},T=function(t,e){for(var i=c<<3|e,o=n.getBCHTypeInfo(i),s=0;s<15;s+=1){var r=!t&&1==(o>>s&1);s<6?u[s][8]=r:s<8?u[s+1][8]=r:u[d-15+s][8]=r}for(var s=0;s<15;s+=1){var r=!t&&1==(o>>s&1);s<8?u[8][d-s-1]=r:s<9?u[8][15-s-1+1]=r:u[8][15-s-1]=r}u[d-8][8]=!t},x=function(t,e){for(var i=-1,o=d-1,s=7,r=0,a=n.getMaskFunction(e),l=d-1;l>0;l-=2)for(6==l&&(l-=1);;){for(var _=0;_<2;_+=1)if(null==u[o][l-_]){var h=!1;r<t.length&&(h=1==(t[r]>>>s&1));var c=a(o,l-_);c&&(h=!h),u[o][l-_]=h,s-=1,s==-1&&(r+=1,s=7)}if(o+=i,o<0||d<=o){o-=i,i=-i;break}}},C=function(e,i){for(var o=0,s=0,r=0,a=new Array(i.length),l=new Array(i.length),_=0;_<i.length;_+=1){var h=i[_].dataCount,c=i[_].totalCount-h;s=Math.max(s,h),r=Math.max(r,c),a[_]=new Array(h);for(var u=0;u<a[_].length;u+=1)a[_][u]=255&e.getBuffer()[u+o];o+=h;var d=n.getErrorCorrectPolynomial(c),p=t(a[_],d.getLength()-1),m=p.mod(d);l[_]=new Array(d.getLength()-1);for(var u=0;u<l[_].length;u+=1){var g=u+m.getLength()-l[_].length;l[_][u]=g>=0?m.getAt(g):0}}for(var f=0,u=0;u<i.length;u+=1)f+=i[u].totalCount;for(var b=new Array(f),v=0,u=0;u<s;u+=1)for(var _=0;_<i.length;_+=1)u<a[_].length&&(b[v]=a[_][u],v+=1);for(var u=0;u<r;u+=1)for(var _=0;_<i.length;_+=1)u<l[_].length&&(b[v]=l[_][u],v+=1);return b},B=function(t,e,i){for(var o=a.getRSBlocks(t,e),_=l(),h=0;h<i.length;h+=1){var c=i[h];_.put(c.getMode(),4),_.put(c.getLength(),n.getLengthInBits(c.getMode(),t)),c.write(_)}for(var u=0,h=0;h<o.length;h+=1)u+=o[h].dataCount;if(_.getLengthInBits()>8*u)throw new Error("code length overflow. ("+_.getLengthInBits()+">"+8*u+")");for(_.getLengthInBits()+4<=8*u&&_.put(0,4);_.getLengthInBits()%8!=0;)_.putBit(!1);for(;;){if(_.getLengthInBits()>=8*u)break;if(_.put(s,8),_.getLengthInBits()>=8*u)break;_.put(r,8)}return C(_,o)};return f.addData=function(t){var e=_(t);g.push(e),m=null},f.isDark=function(t,e){if(t<0||d<=t||e<0||d<=e)throw new Error(t+","+e);return u[t][e]},f.getModuleCount=function(){return d},f.make=function(){b(!1,w())},f.createTableTag=function(t,e){t=t||2,e="undefined"==typeof e?4*t:e;var i="";i+='<table style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: "+e+"px;",i+='">',i+="<tbody>";for(var o=0;o<f.getModuleCount();o+=1){i+="<tr>";for(var s=0;s<f.getModuleCount();s+=1)i+='<td style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: 0px;",i+=" width: "+t+"px;",i+=" height: "+t+"px;",i+=" background-color: ",i+=f.isDark(o,s)?"#000000":"#ffffff",i+=";",i+='"/>';i+="</tr>"}return i+="</tbody>",i+="</table>"},f.createImgTag=function(t,e){t=t||2,e="undefined"==typeof e?4*t:e;var i=f.getModuleCount()*t+2*e,o=e,s=i-e;return p(i,i,function(e,i){if(o<=e&&e<s&&o<=i&&i<s){var n=Math.floor((e-o)/t),r=Math.floor((i-o)/t);return f.isDark(r,n)?0:1}return 1})},f};e.stringToBytes=function(t){for(var e=new Array,i=0;i<t.length;i+=1){var o=t.charCodeAt(i);e.push(255&o)}return e},e.createStringToBytes=function(t,e){var i=function(){for(var i=u(t),o=function(){var t=i.read();if(t==-1)throw new Error;return t},s=0,n={};;){var r=i.read();if(r==-1)break;var a=o(),l=o(),_=o(),h=String.fromCharCode(r<<8|a),c=l<<8|_;n[h]=c,s+=1}if(s!=e)throw new Error(s+" != "+e);return n}(),o="?".charCodeAt(0);return function(t){for(var e=new Array,s=0;s<t.length;s+=1){var n=t.charCodeAt(s);if(n<128)e.push(n);else{var r=i[t.charAt(s)];"number"==typeof r?(255&r)==r?e.push(r):(e.push(r>>>8),e.push(255&r)):e.push(o)}}return e}};var i={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},o={L:1,M:0,Q:3,H:2},s={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},n=function(){var e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],o=1335,n=7973,a=21522,l={},_=function(t){for(var e=0;0!=t;)e+=1,t>>>=1;return e};return l.getBCHTypeInfo=function(t){for(var e=t<<10;_(e)-_(o)>=0;)e^=o<<_(e)-_(o);return(t<<10|e)^a},l.getBCHTypeNumber=function(t){for(var e=t<<12;_(e)-_(n)>=0;)e^=n<<_(e)-_(n);return t<<12|e},l.getPatternPosition=function(t){return e[t-1]},l.getMaskFunction=function(t){switch(t){case s.PATTERN000:return function(t,e){return(t+e)%2==0};case s.PATTERN001:return function(t,e){return t%2==0};case s.PATTERN010:return function(t,e){return e%3==0};case s.PATTERN011:return function(t,e){return(t+e)%3==0};case s.PATTERN100:return function(t,e){return(Math.floor(t/2)+Math.floor(e/3))%2==0};case s.PATTERN101:return function(t,e){return t*e%2+t*e%3==0};case s.PATTERN110:return function(t,e){return(t*e%2+t*e%3)%2==0};case s.PATTERN111:return function(t,e){return(t*e%3+(t+e)%2)%2==0};default:throw new Error("bad maskPattern:"+t)}},l.getErrorCorrectPolynomial=function(e){for(var i=t([1],0),o=0;o<e;o+=1)i=i.multiply(t([1,r.gexp(o)],0));return i},l.getLengthInBits=function(t,e){if(1<=e&&e<10)switch(t){case i.MODE_NUMBER:return 10;case i.MODE_ALPHA_NUM:return 9;case i.MODE_8BIT_BYTE:return 8;case i.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case i.MODE_NUMBER:return 12;case i.MODE_ALPHA_NUM:return 11;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case i.MODE_NUMBER:return 14;case i.MODE_ALPHA_NUM:return 13;case i.MODE_8BIT_BYTE:return 16;case i.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},l.getLostPoint=function(t){for(var e=t.getModuleCount(),i=0,o=0;o<e;o+=1)for(var s=0;s<e;s+=1){for(var n=0,r=t.isDark(o,s),a=-1;a<=1;a+=1)if(!(o+a<0||e<=o+a))for(var l=-1;l<=1;l+=1)s+l<0||e<=s+l||0==a&&0==l||r==t.isDark(o+a,s+l)&&(n+=1);n>5&&(i+=3+n-5)}for(var o=0;o<e-1;o+=1)for(var s=0;s<e-1;s+=1){var _=0;t.isDark(o,s)&&(_+=1),t.isDark(o+1,s)&&(_+=1),t.isDark(o,s+1)&&(_+=1),t.isDark(o+1,s+1)&&(_+=1),0!=_&&4!=_||(i+=3)}for(var o=0;o<e;o+=1)for(var s=0;s<e-6;s+=1)t.isDark(o,s)&&!t.isDark(o,s+1)&&t.isDark(o,s+2)&&t.isDark(o,s+3)&&t.isDark(o,s+4)&&!t.isDark(o,s+5)&&t.isDark(o,s+6)&&(i+=40);for(var s=0;s<e;s+=1)for(var o=0;o<e-6;o+=1)t.isDark(o,s)&&!t.isDark(o+1,s)&&t.isDark(o+2,s)&&t.isDark(o+3,s)&&t.isDark(o+4,s)&&!t.isDark(o+5,s)&&t.isDark(o+6,s)&&(i+=40);for(var h=0,s=0;s<e;s+=1)for(var o=0;o<e;o+=1)t.isDark(o,s)&&(h+=1);var c=Math.abs(100*h/e/e-50)/5;return i+=10*c},l}(),r=function(){for(var t=new Array(256),e=new Array(256),i=0;i<8;i+=1)t[i]=1<<i;for(var i=8;i<256;i+=1)t[i]=t[i-4]^t[i-5]^t[i-6]^t[i-8];for(var i=0;i<255;i+=1)e[t[i]]=i;var o={};return o.glog=function(t){if(t<1)throw new Error("glog("+t+")");return e[t]},o.gexp=function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return t[e]},o}(),a=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16]],e=function(t,e){var i={};return i.totalCount=t,i.dataCount=e,i},i={},s=function(e,i){switch(i){case o.L:return t[4*(e-1)+0];case o.M:return t[4*(e-1)+1];case o.Q:return t[4*(e-1)+2];case o.H:return t[4*(e-1)+3];default:return}};return i.getRSBlocks=function(t,i){var o=s(t,i);if("undefined"==typeof o)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+i);for(var n=o.length/3,r=new Array,a=0;a<n;a+=1)for(var l=o[3*a+0],_=o[3*a+1],h=o[3*a+2],c=0;c<l;c+=1)r.push(e(_,h));return r},i}(),l=function(){var t=new Array,e=0,i={};return i.getBuffer=function(){return t},i.getAt=function(e){var i=Math.floor(e/8);return 1==(t[i]>>>7-e%8&1)},i.put=function(t,e){for(var o=0;o<e;o+=1)i.putBit(1==(t>>>e-o-1&1))},i.getLengthInBits=function(){return e},i.putBit=function(i){var o=Math.floor(e/8);t.length<=o&&t.push(0),i&&(t[o]|=128>>>e%8),e+=1},i},_=function(t){var o=i.MODE_8BIT_BYTE,s=e.stringToBytes(t),n={};return n.getMode=function(){return o},n.getLength=function(t){return s.length},n.write=function(t){for(var e=0;e<s.length;e+=1)t.put(s[e],8)},n},h=function(){var t=new Array,e={};return e.writeByte=function(e){t.push(255&e)},e.writeShort=function(t){e.writeByte(t),e.writeByte(t>>>8)},e.writeBytes=function(t,i,o){i=i||0,o=o||t.length;for(var s=0;s<o;s+=1)e.writeByte(t[s+i])},e.writeString=function(t){for(var i=0;i<t.length;i+=1)e.writeByte(t.charCodeAt(i))},e.toByteArray=function(){return t},e.toString=function(){var e="";e+="[";for(var i=0;i<t.length;i+=1)i>0&&(e+=","),e+=t[i];return e+="]"},e},c=function(){var t=0,e=0,i=0,o="",s={},n=function(t){o+=String.fromCharCode(r(63&t))},r=function(t){if(t<0);else{if(t<26)return 65+t;if(t<52)return 97+(t-26);if(t<62)return 48+(t-52);if(62==t)return 43;if(63==t)return 47}throw new Error("n:"+t)};return s.writeByte=function(o){for(t=t<<8|255&o,e+=8,i+=1;e>=6;)n(t>>>e-6),e-=6},s.flush=function(){if(e>0&&(n(t<<6-e),t=0,e=0),i%3!=0)for(var s=3-i%3,r=0;r<s;r+=1)o+="="},s.toString=function(){return o},s},u=function(t){var e=t,i=0,o=0,s=0,n={};n.read=function(){for(;s<8;){if(i>=e.length){if(0==s)return-1;throw new Error("unexpected end of file./"+s)}var t=e.charAt(i);if(i+=1,"="==t)return s=0,-1;t.match(/^\s$/)||(o=o<<6|r(t.charCodeAt(0)),s+=6)}var n=o>>>s-8&255;return s-=8,n};var r=function(t){if(65<=t&&t<=90)return t-65;if(97<=t&&t<=122)return t-97+26;if(48<=t&&t<=57)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw new Error("c:"+t)};return n},d=function(t,e){var i=t,o=e,s=new Array(t*e),n={};n.setPixel=function(t,e,o){s[e*i+t]=o},n.write=function(t){t.writeString("GIF87a"),t.writeShort(i),t.writeShort(o),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(i),t.writeShort(o),t.writeByte(0);var e=2,s=a(e);t.writeByte(e);for(var n=0;s.length-n>255;)t.writeByte(255),t.writeBytes(s,n,255),n+=255;t.writeByte(s.length-n),t.writeBytes(s,n,s.length-n),t.writeByte(0),t.writeString(";")};var r=function(t){var e=t,i=0,o=0,s={};return s.write=function(t,s){if(t>>>s!=0)throw new Error("length over");for(;i+s>=8;)e.writeByte(255&(t<<i|o)),s-=8-i,t>>>=8-i,o=0,i=0;o=t<<i|o,i+=s},s.flush=function(){i>0&&e.writeByte(o)},s},a=function(t){for(var e=1<<t,i=(1<<t)+1,o=t+1,n=l(),a=0;a<e;a+=1)n.add(String.fromCharCode(a));n.add(String.fromCharCode(e)),n.add(String.fromCharCode(i));var _=h(),c=r(_);c.write(e,o);var u=0,d=String.fromCharCode(s[u]);for(u+=1;u<s.length;){var p=String.fromCharCode(s[u]);u+=1,n.contains(d+p)?d+=p:(c.write(n.indexOf(d),o),n.size()<4095&&(n.size()==1<<o&&(o+=1),n.add(d+p)),d=p)}return c.write(n.indexOf(d),o),c.write(i,o),c.flush(),_.toByteArray()},l=function(){var t={},e=0,i={};return i.add=function(o){if(i.contains(o))throw new Error("dup key:"+o);t[o]=e,e+=1},i.size=function(){return e},i.indexOf=function(e){return t[e]},i.contains=function(e){return"undefined"!=typeof t[e]},i};return n},p=function(t,e,i,o){for(var s=d(t,e),n=0;n<e;n+=1)for(var r=0;r<t;r+=1)s.setPixel(r,n,i(r,n));var a=h();s.write(a);for(var l=c(),_=a.toByteArray(),u=0;u<_.length;u+=1)l.writeByte(_[u]);l.flush();var p="";return p+="<img",p+=' src="',p+="data:image/gif;base64,",p+=l,p+='"',p+=' width="',p+=t,p+='"',p+=' height="',p+=e,p+='"',o&&(p+=' alt="',p+=o,p+='"'),p+="/>"};return e}();/*! scripts/color_utilities.js */
!function(t,e,i){var o={rgb_to_hex:function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},hex_to_rgb:function(t){t=new String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},rgb_to_hsv:function(t,e,i){var o=Math.min(Math.min(t,e),i),s=Math.max(Math.max(t,e),i),n=s-o,r={h:6,s:s?(s-o)/s:0,v:s/255};return n?s===t?r.h+=(e-i)/n:s===e?r.h+=2+(i-t)/n:r.h+=4+(t-e)/n:r.h=0,r.h=60*r.h%360,r},hsv_to_rgb:function(t,e,i){var o,s,n;if(e){o=s=n=0;var r=(t+360)%360/60,a=i*e,l=i-a,_=a*(1-Math.abs(r%2-1));r<1?(o=a,s=_):r<2?(o=_,s=a):r<3?(s=a,n=_):r<4?(s=_,n=a):r<5?(n=a,o=_):(n=_,o=a),o+=l,s+=l,n+=l}else o=s=n=i;return{r:Math.round(255*o),g:Math.round(255*s),b:Math.round(255*n)}},hex_to_hsv:function(t){t=new String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var o=i.ColorUtilities.hex_to_rgb(t),s=i.ColorUtilities.rgb_to_hsv.apply(i.ColorUtilities,e.toArray(o));return s},hsv_to_hex:function(t,o,s){var n=i.ColorUtilities.hsv_to_rgb(t,o,s),r=i.ColorUtilities.rgb_to_hex.apply(i.ColorUtilities,e.toArray(n));return r},hex_brightness:function(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,o,s,n=parseInt(t,16),r=e<0?0:255,a=e<0?-e:e,l=n>>16,_=n>>8&255,h=255&n;return i=Math.round((r-l)*a)+l,o=Math.round((r-_)*a)+_,s=Math.round((r-h)*a)+h,"#"+(16777216+65536*i+256*o+s).toString(16).slice(1)},hsv_to_readable:function(t){return"string"==typeof t&&(t=i.ColorUtilities.hex_to_hsv(t)),t.s<.2&&t.v>.8?"#444":"#FFF"},compare_colors:function(t,i,o){var s={upper_bound:.8,lower_bound:.2,diff_bound:.1,hue_bound:15};e.extend(s,o);var n=s.upper_bound,r=s.lower_bound,a=s.diff_bound,l=s.hue_bound,_=Math.abs(t.h-i.h),h=Math.abs(t.s-i.s),c=Math.abs(t.v-i.v);return _<=a&&h<=a&&c<=a||h<=a&&c<=a&&(h>=n||h<=r&&c>=n||c<=r&&_<=l)}};i.ColorUtilities=o}(jQuery,_,Tumblr),/*! scripts/color_editor/views/_palette.js */
Tumblr.ColorEditor||(Tumblr.ColorEditor={}),function(t,e,i,o){var s=i.View.extend({className:"color_palette",defaults:{colors:[],current_color:!1,current_page:0,on_change:t.noop},events:{"click .swatch":"__color_click","click .pagination a.dot":"__pagination_click","click .pagination a.next":"__pagination_next_click","click .pagination a.previous":"__pagination_previous_click"},__color_click:function(e){e.preventDefault();var i=t(e.currentTarget);i.hasClass("selected")||(this.$(".swatch.selected").removeClass("selected"),i.addClass("selected"),this.update_color(i.data("color")))},__pagination_click:function(e){e.preventDefault();var i=t(e.currentTarget);i.hasClass("selected")||(this.current_page=i.data("page"),this.render(!0))},__pagination_next_click:function(e){e.preventDefault(),!t(e.currentTarget).hasClass("disabled")&&this.current_page<this.page_count-1&&(this.current_page++,this.render(!0))},__pagination_previous_click:function(e){e.preventDefault(),!t(e.currentTarget).hasClass("disabled")&&this.current_page>0&&(this.current_page--,this.render(!0))},initialize:function(t){this.options=e.extend({},this.defaults,t),this.colors=this.options.colors,this.current_color=this.options.current_color,this.current_page=this.options.current_page,this.page_count=this.colors.length},render:function(t){return this.$el.html(this.template({colors:this.colors[this.current_page],current_color:this.current_color,page:this.current_page,page_color:this.colors[this.current_page][4],page_count:this.page_count})),this.$el.toggleClass("paginating",t||!1),this},update_color:function(t){this.current_color=t,this.options.on_change(this.current_color)},template:e.template('            <%                var previous_arrow_class = "arrow previous icon_arrow_carrot_left";                previous_arrow_class += (page === 0) ? " disabled" : "";                var next_arrow_class = "arrow next icon_arrow_carrot_right";                next_arrow_class += (page === page_count - 1) ? " disabled" : "";            %>            <% _.each(colors, function(color) { %>                <a class="swatch<% if(color === current_color){ print(" selected") } %>" data-color="<%= color %>" style="background-color:<%= color %>"><span class="inner_border"></span></a>            <% }); %>            <% if(page_count > 1) { %>                <div class="pagination">                    <a class="<%= previous_arrow_class %>"></a>                    <% for(var i=0; i<page_count; i++) { %>                        <% if(i === page) { %>                            <a class="dot selected" data-page="<%= i %>" style="background-color:<%= page_color %>"></a>                        <% } else { %>                            <a class="dot" data-page="<%= i %>"></a>                        <% } %>                    <% } %>                    <a class="<%= next_arrow_class %>"></a>                </div>            <% } %>        ')});o.Palette=s}(jQuery,_,Backbone,Tumblr.ColorEditor),/*! scripts/color_editor/views/_picker.js */
Tumblr.ColorEditor||(Tumblr.ColorEditor={}),function(t,e,i,o){var s=i.View.extend({className:"color_picker",defaults:{color:{r:0,g:0,b:0},debounce:30,on_change:t.noop},events:{paste:"__paste","mousedown .hue_selector":"__hue_mousedown","mousedown .saturation_wrapper":"__saturation_mousedown","focus .color_text":"__color_text_focus","keyup .color_text":"__color_text_keyup"},__hue_mousedown:function(i){this.hue_width=this.$hue.width();var o=(i.pageX-this.$hue.offset().left)/this.hue_width;this.hsv.h=Math.round(360*o),this.update_hue(),t("body").on("mousemove.pickerhue",e.bind(e.throttle(this.__hue_mousemove,this.options.debounce),this)),t("body").on("mouseup.pickerhue",e.bind(this.__hue_mouseup,this))},__hue_mousemove:function(t){var e=this.$hue.offset().left;if(t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!(t.pageX<e||t.pageX>e+this.hue_width)){var i=(t.pageX-this.$hue.offset().left)/this.hue_width;return this.hsv.h=Math.round(360*i),this.update_hue(),!1}},__hue_mouseup:function(e){e.preventDefault(),e.stopPropagation(),t("body").off(".pickerhue")},__saturation_mousedown:function(i){var o=this.$saturation.offset(),s=i.pageX-o.left,n=i.pageY-o.top;this.saturation_width=this.$saturation.width(),this.saturation_height=this.$saturation.height(),this.hsv.s=Math.max(0,Math.min(s/this.saturation_width,1)),this.hsv.v=Math.max(0,Math.min(1-n/this.saturation_height,1)),this.update_saturation(),this.$saturation_indicator.addClass("dragging"),t("body").on("mousemove.pickersaturation",e.bind(e.throttle(this.__saturation_mousemove,this.options.debounce),this)),t("body").on("mouseup.pickersaturation",e.bind(this.__saturation_mouseup,this))},__saturation_mousemove:function(t){var e=this.$saturation.offset(),i=t.pageX-e.left,o=t.pageY-e.top;return t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,this.hsv.s=Math.max(0,Math.min(i/this.saturation_width,1)),this.hsv.v=Math.max(0,Math.min(1-o/this.saturation_height,1)),this.update_saturation(),!1},__saturation_mouseup:function(){this.$saturation_indicator.removeClass("dragging"),t("body").off(".pickersaturation")},__color_text_keyup:function(e){var i=t(e.currentTarget).val().replace(/[^0-9a-f]/gi,"");13!==e.which||3!==i.length&&6!==i.length||(this.hsv=Tumblr.ColorUtilities.hex_to_hsv(i),this.update_hue(),this.update_saturation(!1))},__paste:function(t){t.preventDefault(),t.stopPropagation();var e=!1;if(window.clipboardData&&window.clipboardData.getData?e=window.clipboardData.getData("Text"):t.originalEvent.clipboardData&&t.originalEvent.clipboardData.getData&&(e=t.originalEvent.clipboardData.getData("text/plain")),e){e=String(e).replace(/[^0-9a-f]/gi,"");var i=/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e);i&&(this.hsv=Tumblr.ColorUtilities.hex_to_hsv(e),this.update_hue(),this.update_saturation(!1))}return!1},initialize:function(i){this.options=e.extend({},this.defaults,i),this.current_color=e.isObject(this.options.color)?this.options.color:Tumblr.ColorUtilities.hex_to_rgb(this.options.color),this.hsv=Tumblr.ColorUtilities.rgb_to_hsv.apply(this,e.toArray(this.current_color)),this.current_hex=!1,this.hue_width=0,this.saturation_height=0,this.saturation_width=0,this.$hue=t(),this.$hue_indicator=t(),this.$saturation=t(),this.$color=t(),this.$color_text=t()},render:function(){return this.$el.html(this.template({color:this.current_color,hue_position:this.hue_position})),this.$hue=this.$(".hue_selector"),this.$hue_indicator=this.$(".hue_selector .indicator"),this.$saturation=this.$(".saturation_wrapper"),this.$saturation_indicator=this.$(".saturation_wrapper .indicator"),this.$color=this.$(".color_value"),this.$color_text=this.$(".color_value .color_text"),this.update_hue(),this.update_saturation(!1),this},update_hue:function(){var t=e.toArray(Tumblr.ColorUtilities.hsv_to_rgb(this.hsv.h,1,1)),i="rgb("+t.toString()+")";this.$hue_indicator.css({"background-color":i,left:Math.round(this.hsv.h/360*100)+"%"}),this.$saturation.css("background-color",i),this.update_color_value()},update_saturation:function(t){t=t||!0,this.$saturation_indicator.css({left:Math.round(100*this.hsv.s)+"%",top:Math.round(100-100*this.hsv.v)+"%"}),t&&this.update_color_value()},update_color_value:function(){var t=Tumblr.ColorUtilities.hsv_to_hex.apply(this,e.toArray(this.hsv)),i=this.hsv.s,o=this.hsv.v;this.$saturation_indicator.css("background-color",t),this.$color.css("background-color",t),this.$color_text.css("color",i<.2&&o>.8?"#444":"#FFF").val(t),this.current_hex&&t!==this.current_hex&&this.options.on_change(t),this.current_hex=t},template:e.template('            <div class="hue_wrapper">                <div class="hue_selector">                    <div class="indicator"></div>                </div>                <div class="color_value">                    <input class="color_text" type="text" maxlength="7" />                </div>            </div>            <div class="saturation_wrapper">                <div class="saturation_inner">                    <div class="indicator"></div>                </div>            </div>        ')});o.Picker=s}(jQuery,_,Backbone,Tumblr.ColorEditor),/*! scripts/color_editor/views/color_editor_view.js */
Tumblr.ColorEditor||(Tumblr.ColorEditor={}),function(t,e,i,o){var s=i.View.extend({className:"color_editor",colors:{red:["#D95E40","#FB4C16","#FF4141","#F0BFB6","#FF7373"],yellow:["#F2992E","#FFD800","#FFF231","#DECBA4","#E7EC6C"],green:["#56BC8A","#56BF4B","#5ACDB3","#9BCACA","#BFE4A8"],blue:["#529ECC","#5AC9E1","#5289DB","#394ACB","#6154C4"],purple:["#A77DC2","#B09BD5","#D969C3","#E1B7D2","#FE3B80"],grayscale:["#FFFFFF","#F6F6F6","#EEEEEE","#CCCCCC","#888888","#666666","#444444","#222222","#000000"]},defaults:{color:"#444444",debounce:30,on_change:t.noop},events:{"click .palette_selector":"__palette_selector_click","click .picker_selector":"__picker_selector_click"},__palette_selector_click:function(e){e.preventDefault();var i=t(e.currentTarget);i.hasClass("selected")||(this.$(".color_selectors .selected").removeClass("selected"),i.addClass("selected"),i.hasClass("custom")?this.render_custom_palette():this.render_palette(i.data("color")))},__picker_selector_click:function(e){e.preventDefault();var i=t(e.currentTarget);i.hasClass("selected")||(this.$(".color_selectors .selected").removeClass("selected"),i.addClass("selected"),this.render_picker())},__custom_palette_change:function(t){this.custom_palette=t,this.$custom_palette_selector.html(this.custom_palette_template({colors:t[0].slice(0,3)})),this.$el.addClass("has_custom_palette"),this.is_custom_palette_open&&this.render_custom_palette()},__color_change:function(t){e.isObject(t)?this.current_color=Tumblr.ColorUtilities.rgb_to_hex(t.r,t.g,t.b):this.current_color=t,this.$picker_selector.css("border-color",this.current_color),this.options.on_change(this.current_color)},initialize:function(i){this.options=e.extend({},this.defaults,i),this.current_color=this.options.color,this.current_color_palette=!1,this.current_color_palette_page=0,this.current_view=null,this.color_palette=null,this.custom_palette=null,this.is_custom_palette_open=!1,this.$color_view=t(),this.$custom_palette_selector=t(),this.$picker_selector=t(),Tumblr.Events&&Tumblr.Flags.bool("indash_header_image_colors")&&this.listenTo(Tumblr.Events,"coloreditor:custompalette",this.__custom_palette_change),this.generate_colors()},render:function(){return this.$el.html(this.template({colors:this.colors})),this.$color_view=this.$(".color_view"),this.$custom_palette_selector=this.$(".palette_selector.custom"),this.$picker_selector=this.$(".picker_selector").css("border-color",this.current_color),this.$(".color_selectors .selected").removeClass("selected"),this.current_color_palette?(this.$('.palette_selector[data-color="'+this.current_color_palette+'"]').addClass("selected"),this.render_palette(this.current_color_palette,this.current_color_palette_page)):(this.$(".picker_selector").addClass("selected"),this.render_picker()),this},render_palette:function(t,i){this.remove_current_view(),this.current_view=new o.Palette({colors:this.color_palette[t],current_color:this.current_color,current_page:i||0,on_change:e.bind(this.__color_change,this)}),this.$color_view.html(this.current_view.render().el)},render_custom_palette:function(){this.custom_palette&&(this.remove_current_view(),this.current_view=new o.Palette({colors:this.custom_palette,current_color:this.current_color,current_page:0,on_change:e.bind(this.__color_change,this)}),this.$color_view.html(this.current_view.render().el),this.is_custom_palette_open=!0)},render_picker:function(){this.remove_current_view(),this.current_view=new o.Picker({color:Tumblr.ColorUtilities.hex_to_rgb(this.current_color),debounce:this.options.debounce,on_change:e.bind(this.__color_change,this)}),this.$color_view.html(this.current_view.render().el)},remove_current_view:function(){this.current_view&&(this.current_view.remove(),this.current_view=null),this.is_custom_palette_open=!1},generate_colors:function(){var t={};e.each(this.colors,function(e,i){if(t[i]=[],"grayscale"===i)e.indexOf(this.current_color)>-1&&(this.current_color_palette=i,this.current_color_palette_page=0),t[i].push(e);else for(var o=0,s=e.length;o<s;o++){var n=this.get_color_variations(e[o]);n.indexOf(this.current_color)>-1&&(this.current_color_palette=i,this.current_color_palette_page=o),t[i].push(n)}},this),this.color_palette=t},get_color_variations:function(t){for(var e=[],i=(Tumblr.ColorUtilities.hex_to_hsv(t),.2),o=4;o>0;o--){var s=i*o;e.push(Tumblr.ColorUtilities.hex_brightness(t,s))}e.push(t);for(var o=1;o<=4;o++){var s=-(i*o);e.push(Tumblr.ColorUtilities.hex_brightness(t,s))}return e},template:e.template('            <div class="color_selectors">                <a class="palette_selector" data-color="red" style="background-color:<%= colors.red[0] %>" />                <a class="palette_selector" data-color="yellow" style="background-color:<%= colors.yellow[0] %>" />                <a class="palette_selector" data-color="green" style="background-color:<%= colors.green[0] %>" />                <a class="palette_selector" data-color="blue" style="background-color:<%= colors.blue[0] %>" />                <a class="palette_selector" data-color="purple" style="background-color:<%= colors.purple[0] %>" />                <a class="palette_selector grayscale" data-color="grayscale" style="background-color:#444" />                <a class="palette_selector custom" />                <a class="picker_selector" />            </div>            <div class="color_view"></div>        '),custom_palette_template:e.template('            <% _.each(colors, function(color) { %>                <span class="custom_color" style="background-color:<%- color %>"></span>            <% }) %>        ')});o.Editor=s}(jQuery,_,Backbone,Tumblr.ColorEditor),/*! scripts/font_picker.js */
function(t,e,i,o){var s=i.View.extend({className:"font_picker",defaults:{fonts:{},current_font:"",current_font_weight:"normal",on_show:t.noop,on_hide:t.noop,on_change:t.noop},events:{"mouseover .font":"__font_mouseover","click .font":"__font_click","click .font_picker_glass":"__glass_click"},__font_mouseover:function(e){t(e.currentTarget)},__font_click:function(e){this.$(".font.selected").removeClass("selected");var i=t(e.currentTarget).addClass("selected");this.current_font=i.attr("data-value"),this.on_change(this.current_font),this.hide()},__glass_click:function(t){t.preventDefault(),this.hide()},initialize:function(t){this.options=e.extend({},this.defaults,t),this.fonts=this.options.fonts,this.current_font=this.options.current_font,this.is_bold="bold"===this.options.current_font_weight,this.on_show=this.options.on_show,this.on_hide=this.options.on_hide,this.on_change=this.options.on_change},render:function(){return this.$el.html(this.template({fonts:this.fonts,current_font:this.current_font})),this.toggle_font_weight(this.is_bold),this},show:function(){this.$el.show(),this.on_show()},hide:function(){this.$el.hide(),this.on_hide()},scroll_to_current_font:function(t){var e=this.$(".font_options"),i=e.children(".selected").first();i.length&&e.scrollTop(t+e.scrollTop()+i.position().top+.5*(i.outerHeight()-e.innerHeight()))},toggle_font_weight:function(t){this.is_bold=!!t,this.$el.toggleClass("bold",this.is_bold)},template:e.template('            <ul class="font_options">                <% _.each(fonts, function(font, font_name) { %>                    <% if(font.hidden) return; %>                    <% if(font_name === current_font) { %>                        <li class="font selected" data-value="<%- font_name %>" style="font-family:<%- font.family %>;"><i class="icon icon_checkmark" /><%- font.display_name %></li>                    <% } else { %>                        <li class="font" data-value="<%- font_name %>" style="font-family:<%- font.family %>;"><i class="icon icon_checkmark" /><%- font.display_name %></li>                    <% } %>                <% }) %>            </ul>            <div class="font_picker_glass"></div>        ')});o.FontPicker=s}(jQuery,_,Backbone,Tumblr);/*! scripts/vendor/color-thief/color-thief.js */
/*!
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * License
 * -------
 * Creative Commons Attribution 2.5 License:
 * http://creativecommons.org/licenses/by/2.5/
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 */
var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};/*!
 * quantize.js Copyright 2008 Nick Rabinowitz.
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * Block below copied from Protovis: http://mbostock.github.com/protovis/
 * Copyright 2010 Stanford Visualization Group
 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
 */
if(ColorThief.prototype.getColor=function(t,e){var i=this.getPalette(t,5,e),o=i[0];return o},ColorThief.prototype.getPalette=function(t,e,i){"undefined"==typeof e&&(e=10),"undefined"==typeof i&&(i=10);for(var o,s,n,r,a,l=new CanvasImage(t),_=l.getImageData(),h=_.data,c=l.getPixelCount(),u=[],d=0;d<c;d+=i)o=4*d,s=h[o+0],n=h[o+1],r=h[o+2],a=h[o+3],a>=125&&(s>250&&n>250&&r>250||u.push([s,n,r]));var p=MMCQ.quantize(u,e),m=p.palette();return l.removeCanvas(),m},!pv)var pv={map:function(t,e){var i={};return e?t.map(function(t,o){return i.index=o,e.call(i,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var i={};return t.reduce(e?function(t,o,s){return i.index=s,t+e.call(i,o)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?pv.map(t,e):t)}};var MMCQ=function(){function t(t,e,i){return(t<<2*l)+(e<<l)+i}function e(t){function e(){i.sort(t),o=!0}var i=[],o=!1;return{push:function(t){i.push(t),o=!1},peek:function(t){return o||e(),void 0===t&&(t=i.length-1),i[t]},pop:function(){return o||e(),i.pop()},size:function(){return i.length},map:function(t){return i.map(t)},debug:function(){return o||e(),i}}}function i(t,e,i,o,s,n,r){var a=this;a.r1=t,a.r2=e,a.g1=i,a.g2=o,a.b1=s,a.b2=n,a.histo=r}function o(){this.vboxes=new e(function(t,e){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function s(e){var i,o,s,n,r=1<<3*l,a=new Array(r);return e.forEach(function(e){o=e[0]>>_,s=e[1]>>_,n=e[2]>>_,i=t(o,s,n),a[i]=(a[i]||0)+1}),a}function n(t,e){var o,s,n,r=1e6,a=0,l=1e6,h=0,c=1e6,u=0;return t.forEach(function(t){o=t[0]>>_,s=t[1]>>_,n=t[2]>>_,o<r?r=o:o>a&&(a=o),s<l?l=s:s>h&&(h=s),n<c?c=n:n>u&&(u=n)}),new i(r,a,l,h,c,u,e)}function r(e,i){function o(t){var e,o,s,n,r,a=t+"1",_=t+"2",h=0;for(l=i[a];l<=i[_];l++)if(p[l]>d/2){for(s=i.copy(),n=i.copy(),e=l-i[a],o=i[_]-l,r=e<=o?Math.min(i[_]-1,~~(l+o/2)):Math.max(i[a],~~(l-1-e/2));!p[r];)r++;for(h=m[r];!h&&p[r-1];)h=m[--r];return s[_]=r,n[a]=s[_]+1,[s,n]}}if(i.count()){var s=i.r2-i.r1+1,n=i.g2-i.g1+1,r=i.b2-i.b1+1,a=pv.max([s,n,r]);if(1==i.count())return[i.copy()];var l,_,h,c,u,d=0,p=[],m=[];if(a==s)for(l=i.r1;l<=i.r2;l++){for(c=0,_=i.g1;_<=i.g2;_++)for(h=i.b1;h<=i.b2;h++)u=t(l,_,h),c+=e[u]||0;d+=c,p[l]=d}else if(a==n)for(l=i.g1;l<=i.g2;l++){for(c=0,_=i.r1;_<=i.r2;_++)for(h=i.b1;h<=i.b2;h++)u=t(_,l,h),c+=e[u]||0;d+=c,p[l]=d}else for(l=i.b1;l<=i.b2;l++){for(c=0,_=i.r1;_<=i.r2;_++)for(h=i.g1;h<=i.g2;h++)u=t(_,h,l),c+=e[u]||0;d+=c,p[l]=d}return p.forEach(function(t,e){m[e]=d-t}),o(a==s?"r":a==n?"g":"b")}}function a(t,i){function a(t,e){for(var i,o=1,s=0;s<h;)if(i=t.pop(),i.count()){var n=r(l,i),a=n[0],_=n[1];if(!a)return;if(t.push(a),_&&(t.push(_),o++),o>=e)return;if(s++>h)return}else t.push(i),s++}if(!t.length||i<2||i>256)return!1;var l=s(t),_=0;l.forEach(function(){_++});var u=n(t,l),d=new e(function(t,e){return pv.naturalOrder(t.count(),e.count())});d.push(u),a(d,c*i);for(var p=new e(function(t,e){return pv.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});d.size();)p.push(d.pop());a(p,i-p.size());for(var m=new o;p.size();)m.push(p.pop());return m}var l=5,_=8-l,h=1e3,c=.75;return i.prototype={volume:function(t){var e=this;return e._volume&&!t||(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var i=this,o=i.histo;if(!i._count_set||e){var s,n,r,a=0;for(s=i.r1;s<=i.r2;s++)for(n=i.g1;n<=i.g2;n++)for(r=i.b1;r<=i.b2;r++)index=t(s,n,r),a+=o[index]||0;i._count=a,i._count_set=!0}return i._count},copy:function(){var t=this;return new i(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var i=this,o=i.histo;if(!i._avg||e){var s,n,r,a,_,h=0,c=1<<8-l,u=0,d=0,p=0;for(n=i.r1;n<=i.r2;n++)for(r=i.g1;r<=i.g2;r++)for(a=i.b1;a<=i.b2;a++)_=t(n,r,a),s=o[_]||0,h+=s,u+=s*(n+.5)*c,d+=s*(r+.5)*c,p+=s*(a+.5)*c;h?i._avg=[~~(u/h),~~(d/h),~~(p/h)]:i._avg=[~~(c*(i.r1+i.r2+1)/2),~~(c*(i.g1+i.g2+1)/2),~~(c*(i.b1+i.b2+1)/2)]}return i._avg},contains:function(t){var e=this,i=t[0]>>_;return gval=t[1]>>_,bval=t[2]>>_,i>=e.r1&&i<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},o.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,i=0;i<e.size();i++)if(e.peek(i).vbox.contains(t))return e.peek(i).color;return this.nearest(t)},nearest:function(t){for(var e,i,o,s=this.vboxes,n=0;n<s.size();n++)i=Math.sqrt(Math.pow(t[0]-s.peek(n).color[0],2)+Math.pow(t[1]-s.peek(n).color[1],2)+Math.pow(t[2]-s.peek(n).color[2],2)),(i<e||void 0===e)&&(e=i,o=s.peek(n).color);return o},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return pv.naturalOrder(pv.sum(t.color),pv.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var i=t.length-1,o=t[i].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[i].color=[255,255,255])}},{quantize:a}}();/*! scripts/indash_blog/models/header_model.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),function(t,e,i,o){var s=i.Model.extend({url:"/svc/indash_blog/header",tumblelog_name_or_id:"",initialize:function(t,e){e=e||{},e.tumblelog_name_or_id&&(this.tumblelog_name_or_id=e.tumblelog_name_or_id),e.url&&(this.url=e.url)},get_theme_param:function(t){var e=this.get("global_theme_params")||{};return e[t]},set_theme_params:function(t){var i=e.clone(this.get("global_theme_params"));this.set("global_theme_params",e.extend({},i,t))},fetch:function(t){t=t||{},t.data={tumblelog_name_or_id:t.tumblelog_name_or_id||this.tumblelog_name_or_id},i.Model.prototype.fetch.call(this,t)},save:function(t,o){var s=e.extend({},this.defaults,t);return s.global_theme_params=e.omit(s.global_theme_params,["header_image_dimens","header_image_focused"]),o=o||{},o.contentType="application/json",o.data=JSON.stringify({tumblelog_name_or_id:this.tumblelog_name_or_id,tumblelog:s}),o.withFormKey=!0,i.Model.prototype.save.call(this,t,o)},parse:function(t,e){return t.response}});o.HeaderModel=s}(jQuery,_,Backbone,Tumblr.IndashBlog),/*! scripts/indash_blog/views/header/dropzone.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({defaults:{accepted_types:/^image\/(gif|jpe?g|png)$/,max_file_size:1e7,upload_url:"/svc/post/upload_photo?source=dropzone"},events:{"dragover .header_dropzone":"__dropzone_dragover","dragleave .header_dropzone":"__dropzone_dragleave","drop .header_dropzone":"__dropzone_drop"},__dropzone_dragover:function(t){t.preventDefault(),this.$el.addClass("drop")},__dropzone_dragleave:function(t){t.preventDefault(),this.$el.removeClass("drop")},__dropzone_drop:function(t){t.preventDefault(),this.$el.removeClass("drop")},__file_add:function(t,e){if(!e.files||!e.files.length)return void this.fail();var i=e.files[0];if(i.type&&!this.options.accepted_types.test(i.type)){var o=this.$input.attr("data-filetype-error")||null,s=this.$input.attr("data-filetype-ok")||null;return void this.fail(o,s)}if(i.size>this.options.max_file_size){var o=this.$input.attr("data-filesize-error")||null,s=this.$input.attr("data-filesize-ok")||null;this.fail(o,s)}else this.file_reader?(this.file_data=e,this.load_preview(i)):(this.file_data=null,this.xhr=this.file_data.submit()),Tumblr.Events.trigger("dropzone:add",this.$input)},__file_send:function(t,e){Tumblr.Events.trigger("dropzone:send",this.$input)},__file_done:function(t,i){if(this.xhr=null,this.file_data=null,!i.result||!e.isArray(i.result.response)||!i.result.response.length)return void this.fail();var o=i.result.response[0];if(e.has(o,"error"))this.fail(o.error);else{var s=i.result.response[0].url;Tumblr.Events.trigger("dropzone:done",this.$input,s)}},__file_fail:function(t,e){this.xhr=null,this.fail()},__save:function(){this.file_data&&(this.xhr=this.file_data.submit())},__preview_loaded:function(t){var i=t.target.result;this.preload_image(i,e.bind(function(){this.render_preview(i)},this))},initialize:function(i){this.options=e.extend({},this.defaults,i),this.form_key=this.options.form_key||t("#tumblr_form_key").attr("content"),this.xhr=null,this.file_data=null,this.file_reader=window.FileReader?new FileReader:null,this.preview_url=!1,this.$dropzone=this.$(".header_dropzone"),this.$input=this.$('input[type="file"]'),this.listenTo(Tumblr.Events,"indashblog:customize:save",this.__save),this.$input.length&&this.initialize_dropzone()},initialize_dropzone:function(){this.$input.fileupload({url:this.options.upload_url,formData:{form_key:this.form_key},maxFileSize:this.options.max_file_size,maxNumberOfFiles:1,pasteZone:null,dropZone:this.$dropzone,fileInput:this.$input,replaceFileInput:!1,previewMaxWidth:500,previewMaxHeight:800,add:e.bind(this.__file_add,this),done:e.bind(this.__file_done,this),send:e.bind(this.__file_send,this),fail:e.bind(this.__file_fail,this)})},cancel:function(){if(this.xhr)try{this.xhr.abort()}catch(t){}},fail:function(t,e){Tumblr.Events.trigger("dropzone:fail",this.$input,t,e)},remove:function(){return this.cancel(),i.View.prototype.remove.call(this)},render_preview:function(t){var e=this.$(".image_preview");e.length>1&&e.filter(":lt(1)").remove(),this.preview_url=t,this.$el.append(this.preview_template({url:t}))},load_preview:function(t){t&&this.file_reader&&(this.file_reader.onload=e.bind(this.__preview_loaded,this),this.file_reader.readAsDataURL(t))},preload_image:function(i,o){var s=new Image;o=o||t.noop,s.onload=e.delay(function(){o()},500),s.src=i},preview_template:e.template('<div class="image_preview" style="background-image:url(<%= url %>)"></div>')});o.Dropzone=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/popover.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({className:"indash_header_popover",defaults:{direction:"left",edit_field:null,template:!1,template_data:{},trigger:null,glassless:!0},__close:function(){this.hide()},initialize:function(i){this.options=e.extend({},this.defaults,i),this.template=this.options.template,this.template_data=this.options.template_data,this.checkbox_template=e.template(t("#tumblelog_header_checkbox_template").html()),this.color_picker_template=e.template(t("#tumblelog_header_color_picker_template").html()),this.is_showing=!1,this.$popover=null,this.popover_view=null,o.Popover.register(this)},render:function(){var i=this.template(this.template_data);return this.$popover=t(i).appendTo(this.$el).hide(),this.popover_view=new Tumblr.Popover({el:this.options.trigger,popover:this.$popover,glassless:this.options.glassless,glassless_options:this.options.glassless_options,auto_show:!1,direction:this.options.direction,skip_offset:!0,on_show:e.bind(function(){this.is_showing||(Tumblr.Events.trigger("indashblog:popover:show",this,this.options.edit_field),this.is_showing=!0)},this),on_hide:e.bind(function(){this.is_showing&&(Tumblr.Events.trigger("indashblog:popover:hide",this,this.options.edit_field),this.is_showing=!1)},this)}),this},show:function(){this.popover_view.show()},hide:function(){this.is_showing&&(Tumblr.Events.trigger("indashblog:popover:hide",this,this.options.edit_field),this.is_showing=!1,this.popover_view.hide())}});s.instances=[],s.register=function(t){this.instances.push(t)},s.hide_all=function(){for(var t=0,e=this.instances.length;t<e;t++)this.instances[t].hide()},o.Popover=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/info_popover.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=o.Popover.extend({template:e.template(t("#tumblelog_header_info_popover_template").html()),defaults:{show_flag_button:!0},events:{"click .ask_menu_item":"__ask_menu_item_clicked","click .fan_mail_menu_item":"__fan_mail_menu_item_clicked","click .archive_menu_item":"__archive_menu_item_clicked","click .block":"__block_click","click .toggle_spam":"__toggle_spam_click","click .toggle_nsfw":"__toggle_nsfw_click","click .toggle_suspended":"__toggle_suspended_click","click .panel_menu_item":"__panel_menu_item_clicked"},__panel_menu_item_clicked:function(t){this.hide()},__ask_menu_item_clicked:function(t){t.preventDefault(),Tumblr.Events.trigger("indashblog:tumblelog:ask",{recipient:this.model.get("name"),anonymous_asks:this.model.get("anonymous_asks")}),this.hide()},__fan_mail_menu_item_clicked:function(t){t.preventDefault(),Tumblr.Events.trigger("indashblog:tumblelog:fan_mail",{recipient:this.model.get("name")}),this.hide()},__archive_menu_item_clicked:function(){this.hide()},__block_click:function(t){t.preventDefault();var i={blockedTumblelog:this.model.get("name")};Tumblr.Prima.Block.confirmBlock(i).then(e.bind(this.__onBlockConfirm,this)),Tumblr.Events.trigger("TumblelogPopover:navigation_menu_item_clicked"),this.hide()},__onBlockConfirm:function(){var t=new Tumblr.Prima.Models.Tumblelog({name:this.model.get("name")});t.block().then(e.bind(this._afterBlock,this))},__toggle_spam_click:function(t){t.preventDefault();var i=this.model.toggle_spam();i.success(e.bind(function(t){this.model.set("spam",!!t.spammer)},this))},__toggle_nsfw_click:function(t){t.preventDefault();var i=this.model.toggle_nsfw();i.success(e.bind(function(t){this.model.set("nsfw",t.nsfw)},this))},__toggle_suspended_click:function(t){t.preventDefault();var i=this.model.toggle_suspended();i.success(e.bind(function(t){this.model.set("suspended",t.suspended)},this))},__model_change:function(){var t=this.model.toJSON();this.$(".toggle_spam").toggleClass("is_flagged",!!t.spam),this.$(".toggle_nsfw").toggleClass("is_flagged",!!t.nsfw),this.$(".toggle_suspended").toggleClass("is_flagged",!!t.suspended)},_afterIgnore:function(){this.model.set("ignoring",!0),this.model.set("following",!1)},_afterBlock:function(){this.model.set("blocking",!0),this.model.set("following",!1)},_open_dialog:function(t,i){i=i||e.noop,this.is_disabled=!0,t.fail(e.bind(function(){this.is_disabled=this.is_menu_open},this)),t.done(e.bind(function(){this.is_disabled=this.is_menu_open,i()},this))},initialize:function(i){if(this.$trigger=i.trigger,this.targetPost=i.targetPost,this.model){var o=this.model.toJSON();e.defaults(o,i,this.defaults),this.$popover=t(this.template(o)).appendTo(this.$el).hide(),this.tumblelog=new Tumblr.Prima.Models.Tumblelog({name:this.model.get("name")}),this.listenTo(this.model,"change",this.__model_change),i=e.extend(i,{popover:this.$popover}),Tumblr.Popover.prototype.initialize.call(this,i)}},show:function(){this.position_popover(),this.listenTo(Tumblr.Events,"DOMEventor:flatresize",this.position_popover),Tumblr.Popover.prototype.show.call(this)},hide:function(){this.stopListening(Tumblr.Events,"DOMEventor:flatresize"),Tumblr.Popover.prototype.hide.call(this)},position_popover:function(){var t=this.$trigger.offset().left+"px";this.$popover.css({right:"auto",left:t})}});o.InfoPopover=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/editable_text.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({defaults:{character_limit:0,show_popover:!0,spellcheck:!1},events:{"keydown .editable_text":"__text_keydown","input .editable_text":"__text_input","blur .editable_text":"__text_blur","paste .editable_text":"__text_paste"},__text_keydown:function(t){8===t.which||t.metaKey||t.ctrlKey||this.character_limit&&this.character_count>=this.character_limit&&(t.preventDefault(),t.stopPropagation())},__text_input:function(){this.update_character_count(),this.$text.toggleClass("empty",!this.character_count)},__text_paste:function(t){var e=t.originalEvent||t;if(e.clipboardData){t.preventDefault();var i=document.createElement("div");i.innerHTML=e.clipboardData.getData("text/html"),document.execCommand("insertHTML",!1,i.innerText||i.textContent)}},__text_blur:function(){this.render_underline()},initialize:function(i){this.options=e.extend({},this.defaults,i),this.character_limit=this.options.character_limit,this.character_count=0,this.$text=this.$(".editable_text"),this.$underline=t(),this.$text.length&&(this.update_character_count(),this.$text.attr({contenteditable:!0,spellcheck:this.options.spellcheck}).toggleClass("empty",!this.character_count))},render:function(){return e.delay(e.bind(this.render_underline,this),100),this},render_underline:function(){this.$underline&&this.$underline.length&&this.$underline.remove();var e=this.$text.innerHeight(),i=parseInt(this.$text.css("line-height")),o=this.underline_template({lines:Math.round(e/i),height:i,width:this.$text.width()});this.$underline=t(o).prependTo(this.$text)},update_character_count:function(){this.$text.length&&(this.$underline&&this.$underline.length&&this.$underline.remove(),this.character_count=this.$text.text().length,this.render_underline())},underline_template:e.template('            <span class="underline">                <% for(var i=0; i<lines; i++) { %>                    <span class="line" style="height:<%= height %>px; width:<%= width %>px"></span>                <% } %>            </span>        ')});o.EditableText=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({className:"indash_header_customize",events:{"click .cancel_button":"__cancel_button_click","click .save_button":"__save_button_click","click #indash_header_overlay":"__popover_overlay_click","click .header_image_glass":"__popover_overlay_click"},__cancel_button_click:function(t){t.preventDefault(),this.is_saving||(this.model.set(this.reset_data),this.remove())},__save_button_click:function(t){t.preventDefault(),this.is_saving=!0,this.$save_button.addClass("loading"),this.$save_button.find(".loader").addClass("animate"),this.__are_current_dropzone_uploads_done()?this.save():Tumblr.Events.trigger("indashblog:customize:save")},__dropzone_add:function(t){this.current_dropzone_uploads[this.__get_id_from_input(t)]=!0,this.enable_save_button()},__dropzone_fail:function(t,i,o){this.current_dropzone_uploads[this.__get_id_from_input(t)]=!1,i&&Tumblr.Dialog&&(this.$el.addClass("dialog_open"),Tumblr.Dialog.alert({text:i,text_ok:o||this.$save_button.data("error-confirm"),callback_ok:e.bind(function(){this.$el.removeClass("dialog_open")},this)}))},__dropzone_done:function(t,e){var i=this.__get_id_from_input(t);switch(i){case"tumblelog_avatar_url":this.model.set("avatar_url",e);break;case"tumblelog_header_image":this.model.set_theme_params({header_image:e})}this.current_dropzone_uploads[i]=!1,this.is_saving&&this.__are_current_dropzone_uploads_done()&&this.save()},__popover_overlay_click:function(t){t.preventDefault(),this.$el.removeClass("popover_open editing_header"),this.$(".editing_focus").removeClass("editing_focus"),o.Popover.hide_all()},__popover_show:function(t,e){this.$el.addClass("popover_open"),e&&e.length&&(e.addClass("editing_focus"),this.$el.toggleClass("editing_header",e.hasClass("header_image")))},__popover_hide:function(t,e){this.$el.removeClass("popover_open editing_header"),e&&e.length&&e.removeClass("editing_focus")},__theme_params_change:function(){var t=this.model.get("global_theme_params"),i=e.result(this.all_fonts,t.title_font),o=Tumblr.ColorUtilities.hex_to_rgb(t.title_color);this.$wrapper.css({"background-color":t.background_color,color:t.title_color}),this.$avatar.css("color",t.background_color),this.$editable_text.css("border-color",t.link_color),this.$(".description").css("color",o),this.$dropzones.css("background-color",t.title_color),this.$title_text.css({"font-family":i?i.family:"inherit","font-weight":t.title_font_weight})},__error:function(){this.$el.addClass("dialog_open"),Tumblr.Dialog.alert({text:this.$save_button.data("error"),text_ok:this.$save_button.data("error-confirm"),callback_ok:function(){window.location.reload()}})},__get_id_from_input:function(t){return t.length?t.attr("id"):""},__are_current_dropzone_uploads_done:function(){return!Object.values(this.current_dropzone_uploads).filter(function(t){return t}).length},initialize:function(i){this.options=e.extend({},this.defaults,i),this.all_fonts=e.isFunction(this.model.getAvailableFonts)?this.model.getAvailableFonts():o.fonts,this.template=e.template(t("#tumblelog_header_customize_template").html()),this.reset_data={},this.is_saving=!1,this.current_dropzone_uploads={tumblelog_avatar_url:!1,tumblelog_header_image:!1},this.$save_button=t(),this.$wrapper=t(),this.$avatar=t(),this.$title_text=t(),this.$editable_text=t(),this.$dropzones=t(),this.listenToOnce(this.model,"error",this.__error),this.listenToOnce(this.model,"change",this.enable_save_button),this.listenTo(this.model,"sync",this.remove),this.listenTo(this.model,"change:global_theme_params",this.__theme_params_change),this.listenTo(Tumblr.Events,"dropzone:add",this.__dropzone_add),this.listenTo(Tumblr.Events,"dropzone:fail",this.__dropzone_fail),this.listenTo(Tumblr.Events,"dropzone:done",this.__dropzone_done),this.listenTo(Tumblr.Events,"indashblog:popover:show",this.__popover_show),this.listenTo(Tumblr.Events,"indashblog:popover:hide",this.__popover_hide),this.subviews={}},render:function(){var i=this.model.toJSON(),o=e.result(this.all_fonts,i.global_theme_params.title_font),s=Tumblr.ColorUtilities.hex_to_rgb(i.global_theme_params.title_color);return this.reset_data=t.extend(!0,{},i),this.$el.html(this.template(e.merge({},i,{title_font_family:!!o&&o.family,title_color_rgb:String(e.values(s).join(","))}))),this.render_customize_views(),this.$save_button=this.$(".save_button").attr("disabled",!0),this.$wrapper=this.$(".indash_header_wrapper"),this.$avatar=this.$(".avatar"),this.$title_text=this.$(".title .editable_text"),this.$editable_text=this.$(".editable_text"),this.$dropzones=this.$(".header_dropzone"),Tumblr.IndashBlog.keycommands&&Tumblr.IndashBlog.keycommands.suspend(!0),Tumblr.IndashBlog.is_peepr&&t("html, body").animate({scrollTop:0},200),this},render_customize_views:function(){this.subviews.header_image_edit=new o.HeaderImage({el:this.$(".header_image"),model:this.model,form_key:this.form_key}),this.subviews.avatar_edit=new o.Avatar({el:this.$(".avatar"),model:this.model,form_key:this.form_key}),this.subviews.title_edit=new o.Title({el:this.$(".title"),model:this.model,all_fonts:this.all_fonts}),this.subviews.description_edit=new o.Description({el:this.$(".description"),model:this.model}),this.subviews.background_color_edit=new o.BackgroundColor({el:this.$(".background_color"),model:this.model}),this.subviews.link_color_edit=new o.LinkColor({el:this.$(".link_color"),model:this.model})},enable_save_button:function(){this.$save_button.attr("disabled",!1)},remove:function(){return e.each(this.subviews,function(t){t.remove()}),Tumblr.IndashBlog.keycommands&&Tumblr.IndashBlog.keycommands.resume(),Tumblr.Popover.hide_all(),this.trigger("remove",this),i.View.prototype.remove.call(this,arguments)},save:function(){this.is_saving=!1,e.isEqual(this.model.attributes,this.reset_data)?this.remove():this.model.save(this.model.attributes,{wait:!0})}});o.Customize=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/header_position.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({el:".header_image",defaults:{background_color:"#000",bounds:{},image:"",loader_color:"#FFF",max_aspect_ratio:16/9,max_zoom:3,show_cancel:!0,zoom_increment:.2},events:{"click .cancel_header_position":"__cancel_click","click .save_header_position":"__save_click","mousedown .full_image":"__image_mousedown","mousedown .zoom_control":"__zoom_mousedown","click .zoom_in":"__zoom_in_click","click .zoom_out":"__zoom_out_click"},__cancel_click:function(t){t.preventDefault(),this.remove()},__save_click:function(t){t.preventDefault();var e=this.dimensions.width/this.image_position.width;this.bounds={top:Math.floor(this.image_position.top*-e),right:Math.floor((this.min_width-this.image_position.left)*e),bottom:Math.floor((this.min_height-this.image_position.top)*e),left:Math.floor(this.image_position.left*-e)},this.trigger("save",this.bounds,this.image_position),this.remove()},__image_mousedown:function(t){this.drag_position={x:t.pageX,y:t.pageY},this.$body.on("mousemove.header_position",e.throttle(e.bind(this.__image_mousemove,this),40)),this.$body.on("mouseup.header_position",e.bind(this.__image_mouseup,this)),this.$body.addClass("dragging_header_image")},__image_mousemove:function(t){return t.preventDefault(),t.stopPropagation(),this.image_position.left+=t.pageX-this.drag_position.x,this.image_position.top+=t.pageY-this.drag_position.y,this.drag_position.x=t.pageX,this.drag_position.y=t.pageY,this.position_image(),!1},__image_mouseup:function(){this.$body.off(".header_position").removeClass("dragging_header_image"),e.delay(e.bind(this.snap_image,this),50)},__zoom_mousedown:function(t){this.$body.on("mousemove.header_position",e.throttle(e.bind(this.__zoom_mousemove,this),20)),this.$body.on("mouseup.header_position",e.bind(this.__zoom_mouseup,this)),this.$body.addClass("dragging_header_image")},__zoom_mousemove:function(t){t.preventDefault(),t.stopPropagation();var e=this.$zoom_track.width(),i=Math.round(t.pageX-this.$zoom_track.offset().left);return i>0&&i<e&&(this.zoom=1+(this.options.max_zoom-1)*(i/e),this.zoom_image()),!1},__zoom_mouseup:function(){this.$body.off(".header_position").removeClass("dragging_header_image"),e.delay(e.bind(this.snap_image,this),50)},__zoom_in_click:function(t){t.preventDefault();var e=this.zoom+this.options.zoom_increment;this.zoom=e>this.options.max_zoom?this.options.max_zoom:e,this.zoom_image()},__zoom_out_click:function(t){t.preventDefault();var e=this.zoom-this.options.zoom_increment;this.zoom=e<1?1:e,this.zoom_image()},__escape:function(t){this.is_open&&this.options.show_cancel&&this.remove()},initialize:function(i){this.options=e.extend({},this.defaults,i),this.image=this.options.image,this.bounds=this.options.bounds,this.dimensions=this.options.dimensions,this.template=e.template(t("#tumblelog_header_position_template").html()),this.aspect_ratio=1,this.zoom=1,this.scale=1,this.min_width=0,this.min_height=0,this.center_point={},this.drag_position={x:0,y:0},this.image_position={left:0,top:0,height:0,width:0},this.is_open=!1,this.$body=t("body"),this.$container=t(),this.$loader=t(),this.$image=t(),this.$zoom_track=t(),this.$zoom_control=t(),this.listenTo(Tumblr.Events,"DOMEventor:keydown:escape",this.__escape),this.render()},render:function(){this.$el.append(this.template({background_color:this.options.background_color,image:this.image,loader_color:this.options.loader_color,show_cancel:this.options.show_cancel})),this.$container=this.$(".indash_header_position_wrapper").addClass("loading"),this.$loader=this.$container.find(".loader").addClass("animate"),this.$image=this.$container.find(".full_image"),this.$zoom_track=this.$container.find(".header_zoom"),this.$zoom_control=this.$container.find(".zoom_control"),this.$body.addClass("positioning_header"),Tumblr.IndashBlog.keycommands&&Tumblr.IndashBlog.keycommands.suspend();var t=this.$container.get(0).getBoundingClientRect();return this.min_height=t.height,this.min_width=t.width,this.is_open=!0,this.center_point={x:.5*this.min_width,y:.5*this.min_height},this.preload_image(this.image,e.bind(function(t){this.dimensions={height:t.height,width:t.width},this.ready()},this)),this},ready:function(){var t=!!e.size(this.bounds),i=t?this.bounds.right-this.bounds.left:this.dimensions.width,o=t?this.bounds.bottom-this.bounds.top:this.dimensions.height;this.aspect_ratio=this.dimensions.width/this.dimensions.height,this.zoom=this.aspect_ratio<=this.options.max_aspect_ratio?this.dimensions.width/i:this.dimensions.height/o,this.scale=this.aspect_ratio<=this.options.max_aspect_ratio?this.min_width/this.dimensions.width:this.min_height/this.dimensions.height;var s=this.scale*this.zoom,n=this.dimensions.height*s,r=this.dimensions.width*s;this.image_position={left:t?this.bounds.left*-s:this.center_point.x-.5*r,top:t?this.bounds.top*-s:this.center_point.y-.5*n,height:n,width:r},this.$container.removeClass("loading"),this.$loader.remove(),this.zoom_image()},remove:function(){Tumblr.IndashBlog.keycommands&&Tumblr.IndashBlog.keycommands.resume(!0),this.is_open=!1,this.stopListening(),this.$body.removeClass("positioning_header"),this.$container.remove(),this.trigger("remove",this)},preload_image:function(e,i){var o=document.createElement("img");i=i||t.noop,t(o).on("load error",function(){t(o).off(),i(o)}),o.src=e},zoom_image:function(){var t=this.scale*this.zoom,e=this.dimensions.width*t,i=this.dimensions.height*t,o=e-this.image_position.width,s=i-this.image_position.height,n=this.image_position.left-o*((Math.abs(this.image_position.left)+this.center_point.x)/this.image_position.width),r=this.image_position.top-s*((Math.abs(this.image_position.top)+this.center_point.y)/this.image_position.height);this.image_position={left:n,top:r,width:e,height:i},this.snap_image()},position_image:function(){var t=(this.zoom-1)/(this.options.max_zoom-1);this.$zoom_control.css("left",t*this.$zoom_track.width()),this.$image.css(this.image_position)},snap_image:function(){this.image_position.left+this.image_position.width<this.min_width&&(this.image_position.left=this.min_width-this.image_position.width),this.image_position.left>0&&(this.image_position.left=0),this.image_position.top+this.image_position.height<this.min_height&&(this.image_position.top=this.min_height-this.image_position.height),this.image_position.top>0&&(this.image_position.top=0),this.position_image()}});o.HeaderImagePosition=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize_fields/avatar_edit.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=o.Dropzone.extend({events:function(){return e.defaults({"click .choose_photo":"__choose_photo_click","click .avatar_shape":"__avatar_shape_click","change #tumblelog_show_avatar":"__show_avatar_change"},o.Dropzone.prototype.events)},__choose_photo_click:function(t){t.preventDefault(),this.$input.trigger("click")},__avatar_shape_click:function(e){if(e.preventDefault(),!t(e.currentTarget).hasClass("selected")){var i=this.$(".avatar_shape.selected"),o=t(e.currentTarget).addClass("selected"),s=o.data("value");i.length&&i.removeClass("selected"),this.$el.removeClass(this.model.get_theme_param("avatar_shape")).addClass(s),this.model.set_theme_params({avatar_shape:s})}},__show_avatar_change:function(e){var i=t(e.currentTarget).is(":checked");this.model.set_theme_params({show_avatar:i}),this.$el.toggleClass("disabled",!i)},initialize:function(i){o.Dropzone.prototype.initialize.call(this,i),this.popover=new o.Popover({direction:"left",edit_field:this.$el,template:e.template(t("#tumblelog_header_avatar_popover_template").html()),template_data:this.model.toJSON(),trigger:this.$(".edit_button"),glassless_options:{prevent_clicks:!1,click_root:this.$el}}),this.$avatar_shape=this.$("#tumblelog_avatar_shape"),this.model.get("global_theme_params").show_avatar||this.$el.addClass("disabled"),this.$el.append(this.popover.render().el)},remove:function(){return this.cancel(),this.popover.remove(),i.View.prototype.remove.call(this)}});o.Avatar=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize_fields/background_color_edit.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({__color_editor_change:function(t){this.$color_dot.css("background-color",t),this.model.set_theme_params({background_color:t})},initialize:function(i){this.options=e.extend({},this.defaults,i),this.$color_dot=t(),this.popover=new o.Popover({direction:"up",edit_field:this.$el,template:e.template(t("#tumblelog_header_color_popover_template").html()),trigger:this.$el,glassless_options:{prevent_clicks:!1,click_root:this.$el}}),this.color_editor=new Tumblr.ColorEditor.Editor({color:this.model.get_theme_param("background_color"),on_change:e.bind(this.__color_editor_change,this)}),this.render()},render:function(){return this.$el.append(this.popover.render().el),this.$(".popover_inner").append(this.color_editor.render().el),this.$color_dot=this.$(".color_dot"),this}});o.BackgroundColor=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize_fields/description_edit.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=o.EditableText.extend({events:function(){return e.defaults({"focus .editable_text":"__text_focus","change #tumblelog_show_description":"__show_description_change"},o.EditableText.prototype.events)},__text_focus:function(){this.popover.show()},__text_blur:function(e){var i=t(e.currentTarget).text();this.model.set("description",i),o.EditableText.prototype.__text_blur.call(this)},__show_description_change:function(e){var i=t(e.currentTarget).is(":checked");this.model.set_theme_params({show_description:i}),this.$el.toggleClass("disabled",!i)},initialize:function(i){o.EditableText.prototype.initialize.call(this,i),this.popover=new o.Popover({direction:"up",edit_field:this.$el,trigger:!1,template:e.template(t("#tumblelog_header_description_popover_template").html()),template_data:this.model.toJSON(),glassless_options:{prevent_clicks:!1,click_root:this.$el}}),this.model.get("global_theme_params").show_description||this.$el.addClass("disabled"),this.$el.append(this.popover.render().el),o.EditableText.prototype.render.call(this)}});o.Description=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize_fields/header_image_edit.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=o.Dropzone.extend({events:function(){return e.defaults({"click .choose_photo":"__choose_photo_click","click .position_photo":"__position_photo_click","change #tumblelog_stretch_header_image":"__stretch_header_image_change","change #tumblelog_show_header_image":"__show_header_image_change"},o.Dropzone.prototype.events)},__choose_photo_click:function(t){t.preventDefault(),this.$input.click()},__position_photo_click:function(t){return t.preventDefault(),t.stopPropagation(),this.popover.hide(),this.render_header_position(),!1},__stretch_header_image_change:function(e){var i=t(e.currentTarget).is(":checked");this.model.set_theme_params({header_stretch:i}),this.$(".position_photo").toggleClass("disabled",!i)},__show_header_image_change:function(e){var i=t(e.currentTarget).is(":checked");this.model.set_theme_params({show_header_image:i}),this.$el.toggleClass("disabled",!i)},__position_header_save:function(t,e){this.model.set_theme_params({header_bounds:t});var i=this.model.get("global_theme_params");this.$el.css({"background-image":"url("+(this.preview_url||i.header_image)+")","background-position":e.left+"px "+e.top+"px","background-size":e.width+"px "+e.height+"px"})},__position_header_remove:function(){this.stopListening(this.position_header_view),this.position_header_view=null},initialize:function(i){o.Dropzone.prototype.initialize.call(this,i),this.position_photo_view=null,this.color_thief=null,this.popover=new o.Popover({direction:"right",edit_field:this.$el,template:e.template(t("#tumblelog_header_image_popover_template").html()),template_data:this.model.toJSON(),trigger:this.$(".edit_button"),glassless_options:{prevent_clicks:!1}}),this.position_header_view=null,this.$el.append(this.popover.render().el),this.setup()},setup:function(){var t=this.model.get("global_theme_params");t.show_header_image||this.$el.addClass("disabled"),t.header_stretch||this.$(".position_photo").addClass("disabled")},render_header_position:function(t){var e=this.model.get("global_theme_params");t=!!t||!1,this.position_header_view=new o.HeaderImagePosition({el:this.$el,background_color:e.background_color,bounds:this.preview_url?{}:e.header_bounds,image:this.preview_url||e.header_image,loader_color:e.title_color,show_cancel:!t}),this.listenToOnce(this.position_header_view,"remove",this.__position_header_remove),this.listenToOnce(this.position_header_view,"save",this.__position_header_save)},render_preview:function(t){this.preview_url=t,this.popover.hide(),this.$el.css("background-image","url("+this.preview_url+")"),this.$("img").attr("src",this.preview_url),this.model.get_theme_param("header_stretch")&&this.render_header_position(!0),this.generate_color_palette(t)},generate_color_palette:function(t){if(Tumblr.Flags.bool("indash_header_image_colors")&&ColorThief){this.color_thief=this.color_thief||new ColorThief;var i=new Image;i.onload=e.bind(function(){var t=this.color_thief.getPalette(i,10);if(t&&Tumblr.Events&&Tumblr.ColorUtilities){var o=[];e.each(t,function(t){var i=Tumblr.ColorUtilities.rgb_to_hex.apply(null,e.toArray(t));o.push(i)}),Tumblr.Events.trigger("coloreditor:custompalette",[o])}},this),i.src=t}},remove:function(){return this.cancel(),i.View.prototype.remove.call(this)}});o.HeaderImage=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize_fields/link_color_edit.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=i.View.extend({__color_editor_change:function(t){this.$color_dot.css("background-color",t),this.model.set_theme_params({link_color:t})},initialize:function(i){this.options=e.extend({},this.defaults,i),this.$color_dot=t(),this.popover=new o.Popover({direction:"up",glassless:!0,glassless_options:{prevent_clicks:!1},edit_field:this.$el,template:e.template(t("#tumblelog_header_color_popover_template").html()),trigger:this.$el}),this.color_editor=new Tumblr.ColorEditor.Editor({color:this.model.get_theme_param("link_color"),on_change:e.bind(this.__color_editor_change,this)}),this.render()},render:function(){return this.$el.append(this.popover.render().el),this.$(".popover_inner").append(this.color_editor.render().el),this.$color_dot=this.$(".color_dot"),this}});o.LinkColor=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/customize_fields/title_edit.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){var s=o.EditableText.extend({events:function(){return e.defaults({"focus .editable_text":"__text_focus","change #tumblelog_show_title":"__show_title_change","click .current_font":"__font_click","click .font_weight":"__font_weight_click"},o.EditableText.prototype.events)},__text_focus:function(){this.popover.show()},__text_blur:function(){var t=this.$text.text();this.model.set("title",t),o.EditableText.prototype.__text_blur.call(this)},__show_title_change:function(e){var i=t(e.currentTarget).is(":checked");this.model.set_theme_params({show_title:i}),this.$el.toggleClass("disabled",!i)},__color_editor_change:function(t){this.model.set_theme_params({title_color:t})},__font_click:function(t){t.preventDefault(),this.font_picker.show(),this.font_picker.scroll_to_current_font(-38)},__font_change:function(t){var i=e.result(this.all_fonts,t);i&&(this.$current_font.css("font-family",i.family),this.$current_font_label.text(i.display_name),this.model.set_theme_params({title_font:t})),this.render_underline()},__font_weight_click:function(e){var i=t(e.currentTarget),o=!i.hasClass("on"),s=o?"bold":"normal";this.font_picker.toggle_font_weight(o),this.model.set_theme_params({title_font_weight:s}),this.$current_font.css("font-weight",s),i.toggleClass("on",o)},initialize:function(i){if(o.EditableText.prototype.initialize.call(this,e.extend({character_limit:50},i)),this.all_fonts=this.options.all_fonts,this.current_font=e.result(this.all_fonts,this.model.get_theme_param("title_font")),!this.current_font){var s=e.first(e.keys(this.all_fonts));this.current_font=this.all_fonts[s]}this.$current_font=t(),this.$current_font_label=t(),this.popover=new o.Popover({direction:"up",edit_field:this.$el,trigger:!1,template:e.template(t("#tumblelog_header_title_popover_template").html()),template_data:e.merge(this.model.toJSON(),{current_font:this.current_font||!1}),glassless_options:{prevent_clicks:!1,click_root:this.$el}}),this.color_editor=new Tumblr.ColorEditor.Editor({color:this.model.get_theme_param("title_color"),on_change:e.bind(this.__color_editor_change,this)}),this.font_picker=new Tumblr.FontPicker({fonts:this.all_fonts,current_font:this.model.get_theme_param("title_font"),current_font_weight:this.model.get_theme_param("title_font_weight"),on_change:e.bind(this.__font_change,this)}),this.model.get("global_theme_params").show_title||this.$el.addClass("disabled"),this.render()},render:function(){return this.$el.append(this.popover.render().el),this.$(".title_popover").append(this.color_editor.render().el),this.$(".font_dropdown").append(this.font_picker.render().el),this.$current_font=this.$(".current_font"),this.$current_font_label=this.$current_font.find("span"),o.EditableText.prototype.render.call(this),this}});o.Title=s}(jQuery,_,Backbone,Tumblr.IndashBlog.Header);/*! scripts/indash_blog/views/header_view.js */
var TumblrData=window.TumblrData||{};Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,i,o){"use strict";var s=i.View.extend({el:".header",defaults:{aspect_ratio:9/16,show_navigation:!0,show_share_controls:!1,show_dismiss_controls:!1,show_user_controls:!1,show_follow_button:!1,on_customize_open:t.noop,on_customize_close:t.noop},events:{"click .customize_button":"__customize_button_clicked","click .follow":"__follow_button_clicked","click .unfollow":"__unfollow_button_clicked","click .open_blog_button":"__open_blog_button_clicked","click .show_description":"__toggle_description_click","click .description a":"__description_link_click"},__open_blog_button_clicked:function(e){e.preventDefault(),new Tumblr.Prima.SharePopover({popoverData:{url:this.model.get("url"),tumblelog_name:this.model.get("name"),show_permalink:!1,show_embed:!1,show_pinterest:!1,show_reddit:!1,show_reporting_links:!1,show_flagging:!1,tumblelog_share:!0},pinnedTarget:t(e.target)}).render()},__follow_button_clicked:function(t){this.model.set("following",!0)},__unfollow_button_clicked:function(t){var e=Tumblr.Prima.Translate;Tumblr.Dialog.confirm({text:e("Are you sure you want to unfollow %1$s?",this.model.get("name")),text_ok:e("Ok"),callback_ok:function(){this.model.set("following",!1)}.bind(this),text_cancel:e("Nevermind"),templates:{content:['<div class="avatar_image" style="background-image: url('+this.model.get("avatar_url")+');">','<div class="avatar_frame"></div>',"</div>",'<span class="text"><%= text %></span>'].join("")}})},__customize_button_clicked:function(t){t.preventDefault(),this.start_customizing()},__toggle_description_click:function(t){t.preventDefault(),this.$description.toggleClass("show_all"),this.$description_inner.css("height",this.$description.hasClass("show_all")?this.$description_inner.get(0).scrollHeight:"")},__description_link_click:function(i){var o=t(i.currentTarget).attr("href");if(!e.startsWith(o.toLowerCase(),"mailto:")){i.preventDefault();try{if(Tumblr.Prima.Url&&Tumblr.Prima.Url.hasAllowedProtocol(o)){if(!Tumblr.Prima.Url.isAbsoluteUrl(o)){var s="http://"+this.model.get("name")+".tumblr.com/";o="/"===o.charAt(0)?o.substr(1):o,o=s+o}window.open(o,"_blank")}}catch(n){}}},__theme_param_change:function(){var t=this.model.get("global_theme_params");this.$(".indash_header_wrapper").toggleClass("no_stretch_header",!t.header_stretch)},__window_scroll:function(t){this.set_sticky_header(this._near_top(t.windowScrollTop)),this.parallax_header(t.windowScrollTop)},_render_follow_button:function(){this.model.get("following")?(this.$el.find(".follow").hide(),this.$el.find(".unfollow").show()):(this.$el.find(".unfollow").hide(),this.$el.find(".follow").show())},_customize_remove:function(){this.stopListening(this.customize_view),this.customize_view=null,this.render(),this.on_customize_close()},_near_top:function(t){return t>=this.header_image_height},__addSnowMan:function(){var t={el:this.$el.find(".indash_header_wrapper"),auto_show:!1,trigger:this.$el.find(".info_popover_button"),useRecipient:!0,glassless:!0,standalone:!0,show_flag_button:!0,show_user_controls:this.options.show_user_controls};this.snowman=new Tumblr.Prima.Snowman({el:this.$("[data-snowman-container]"),tumblelogName:this.model.get("name"),infoPopover:t})},initialize:function(i){this.options=e.extend({header_min_height:50,parallax_inertia:.3,avatar_inertia:.4},this.defaults,i),this.is_peepr=o.is_peepr||this.options.is_peepr,this.on_customize_open=this.options.on_customize_open,this.on_customize_close=this.options.on_customize_close,this.$show_description=t(),this.$header_image=t(),this.$navigation_bg=t(),this.$blurred_header=t(),this.template=e.template(t("#tumblelog_header_template").html()),this.inline_styles_template=e.template(t("#tumblelog_header_inline_styles").html()),this.customize_view=null,this.listenTo(this.model,"change:global_theme_params",this.__theme_param_change),this.listenTo(this.model,"change:following",this._render_follow_button),this.is_peepr&&this.listenTo(Tumblr.Events,"DOMEventor:flatscroll peepr-body-scroll",this.__window_scroll,this)},render:function(){if(!this.model)return this;if(!e.isEmpty(this.model.get("advertiser_name")))return this.$el.addClass("blogless-advertiser"),this;var t=this.model.toJSON(),i=e.isFunction(this.model.getAvailableFonts)?this.model.getAvailableFonts():TumblrData.fonts,o=e.result(i,t.global_theme_params.title_font),s=Tumblr.ColorUtilities.hex_to_rgb(t.global_theme_params.title_color);this.$el.html(this.template(e.merge({},t,{show_navigation:this.options.show_navigation,show_share_controls:this.options.show_share_controls,show_dismiss_controls:this.options.show_dismiss_controls,show_user_controls:this.options.show_user_controls,show_follow_button:this.options.show_follow_button,has_peepr_header:!1,title_font_family:!!o&&o.family,title_color_rgb:String(e.values(s).join(",")),is_verified:!1})));var n=this.$el.width();this.$(".header_image_wrapper, .header_image").height(n*this.options.aspect_ratio),this.cache_selectors(),this.$description_inner.length&&this.truncate_description(),this.render_inline_styles();var r=!(!t.global_theme_params.header_image_focused||!t.global_theme_params.show_header_image);this.is_peepr&&r&&t.global_theme_params.header_stretch&&this.generate_short_header(),this.__addSnowMan();var a=Tumblr.Prima.currentUser(),l=e.contains(a.channels.pluck("name"),this.model.get("name"));return a.canMessage()&&!l&&this.model.get("can_receive_messages")&&(this.messaging_popover=new Tumblr.Prima.MessagingPopover({model:this.model}).render(),this.$(".indash_header_wrapper .open_blog_button").after(this.messaging_popover.$el)),this.parallax_header(0),this.searchView=new Tumblr.Prima.PeeprSearch({blog:this.model}),this.$(".navigation_inner h3").after(this.searchView.render().$el),this.$el.hasClass("loading")&&this.preload_images(this.$el,e.bind(function(){this.$el.removeClass("loading")},this)),this},render_inline_styles:function(){this.$("#indash_blog_styles").length&&this.$("#indash_blog_styles").remove();var t=this.model.toJSON(),i=t.global_theme_params.link_color,o=Tumblr.ColorUtilities.hex_to_hsv(t.global_theme_params.link_color),s=Tumblr.ColorUtilities.hex_to_hsv(t.global_theme_params.background_color);return Tumblr.ColorUtilities.compare_colors(o,s)&&(i=Tumblr.ColorUtilities.hsv_to_readable(s)),this.$el.prepend(this.inline_styles_template(e.extend({link_font_color:Tumblr.ColorUtilities.hsv_to_readable(o),header_override_color:i},t))),this},remove:function(){this.stopListening(),this.undelegateEvents(),this.searchView&&this.searchView.remove(),this.snowman&&this.snowman.remove()},generate_short_header:function(){var i=this.model.get_theme_param("header_image_focused");if(i){var o=document.createElement("img"),s=document.createElement("canvas"),n=s.getContext("2d");this.$navigation_bg.length&&(this.$navigation_bg.addClass("has_image"),s.className="sticky_header_image",s.width=this.$header_image.width(),s.height=this.$header_image.height(),o.onload=e.bind(function(){var e=o.naturalWidth/o.naturalHeight;o.width=s.width,o.height=o.width/e,o.height<s.height&&(o.height=s.height,o.width=o.height*e),n.drawImage(o,.5*-(o.width-s.width),.5*-(o.height-s.height),o.width,o.height),n.fillStyle="rgba(0,0,0,0.4)",n.fillRect(0,0,s.width,s.height),this.$blurred_header=t(s),this.$navigation_bg.html(this.$blurred_header)},this),o.src=i)}},truncate_description:function(){var t=this.$description_inner.get(0);t.scrollHeight<=t.clientHeight||(this.is_description_truncated=!0,this.$description.addClass("truncated"),this.render_description_gradient())},render_description_gradient:function(){var i=this.model.get_theme_param("background_color"),o=Tumblr.ColorUtilities.hex_to_rgb(i);this.$show_description.length&&this.$show_description.remove(),this.$show_description=t(this.show_description_template({background_color:String(e.values(o).join(",")),title_color:this.model.get_theme_param("title_color")})).appendTo(this.$description)},cache_selectors:function(){this.$win=t(window),this.$header_image=this.$(".header_image"),this.$avatar=this.$(".avatar"),this.$description=this.$(".description"),this.$description_links=this.$(".description a"),this.$description_inner=this.$(".description .description_inner"),this.$navigation_bg=this.$(".navigation_bg"),this.$sticky_items=this.$("[data-sticky-styles]"),this.header_image_height=this.$header_image.height()-this.options.header_min_height>this.options.header_min_height?this.$header_image.height()-this.options.header_min_height:this.options.header_min_height},parallax_header:function(t){if(this.is_peepr&&!this.customize_view&&this.$header_image.length){var i=e.isUndefined(t)?this.$win.scrollTop():t;if(!(i>this.header_image_height)){var o=Math.round(i*this.options.parallax_inertia);this.$header_image.css({transform:"translate3d(0,"+o+"px, 0)"});var s=i*this.options.avatar_inertia,n=(100-s)/100;if(n<0&&(n=0),this.$avatar.css({opacity:n}),this.$navigation_bg.length&&this.$blurred_header.length){var r=this.$header_image.height()-i,a=o-i;this.$navigation_bg.css({height:r,opacity:1-n}),this.$blurred_header.css({transform:"translate3d(0,"+a+"px, 0)"})}}}},set_sticky_header:function(t){t?(this.$el.addClass("sticky_header"),this.$navigation_bg.css({height:"",opacity:""})):this.$el.removeClass("sticky_header")},close_customize:function(){this.customize_view&&this.customize_view.remove()},preload_images:function(e,i){var o=t(e).find("img"),s=document.createElement("img"),n=0;i=i||t.noop,o.length||i();for(var r=0,a=o.length;r<a;r++)t(s).on("load error",function(){t(s).off(),n++,n===a&&i()}),s.src=o[r].src},start_customizing:function(){this.customize_view=new o.Header.Customize({model:this.model}),this.listenTo(this.customize_view,"remove",this._customize_remove),this.$el.html(this.customize_view.render().el);var t=this.$el.width();this.$(".header_image").height(t*this.options.aspect_ratio),this.on_customize_open()},show_description_template:e.template('            <div class="show_description" style="                background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));                background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);                background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);                background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);                background: linear-gradient(to bottom,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);                color: <%= title_color %>;            ">                <i class="show_icon icon_arrow_carrot_down"></i>                <i class="hide_icon icon_arrow_carrot_up"></i>            </div>        ')});o.HeaderView=s,o.Header.fonts=TumblrData.fonts||{}}(jQuery,_,Backbone,Tumblr.IndashBlog),/*! scripts/tumblr/flat_select.js */
function(t,e,i,o){var s=i.View.extend({el:"body",defaults:{},events:{"change .flat_select select":"__select_change"},__select_change:function(e){var i=t(e.currentTarget);this.update_select(i)},initialize:function(t){this.options=e.extend({},this.defaults,t)},update_select:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});o.FlatSelect=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/utils/settings_validators.js */
function(t,e){var i={is_blank:function(e){return""===t.trim(e)},min_length:function(t,e){return t.length>=e},max_length:function(t,e){return t.length<=e},range:function(t,e,i){return t.length>=e&&t.length<=i},pattern:function(t,e){return!!new RegExp(e,"gi").test(t)},is_email:function(t){return this.pattern(t,"^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")},equals:function(t,e){return t===e}};e.settings_validators=i}(jQuery,Tumblr),/*! scripts/settings/models/settings_model.js */
function(t,e,i,o){var s=i.Model.extend({url:"/settings/save",defaults:{form_key:t("#tumblr_form_key").attr("content"),secure_form_key:t('input[name="secure_form_key"]').val()},initialize:function(){this.defaults=e.extend({},this.attributes,this.defaults)},validate:function(t){if(t.errors)return t.errors},save:function(t,o){o=o||{},o.contentType="application/json",o.data=JSON.stringify(e.extend({},this.defaults,t)),o.withFormKey=!0,i.Model.prototype.save.call(this,t,o)},parse:function(t){var i=e.omit(t,["meta","response"]);return i}});o.SettingsModel=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/models/account_model.js */
function(t,e,i){var o=Tumblr.SettingsModel.extend({defaults:e.extend({},Tumblr.SettingsModel.prototype.defaults,{page:"account"}),validate:function(t){var i,o,s,n={};if(e.isUndefined(t["email[new]"])||(Tumblr.settings_validators.is_email(t["email[new]"])||(n["email[new]"]="Email appears to be invalid."),(i=this.validate_password(t["email[password]"]))&&(n["email[password]"]=i)),!e.isUndefined(t["password[current]"])&&(o=this.validate_password(t["password[current]"]))&&(n["password[current]"]=o),e.isUndefined(t["password[new]"])||((s=this.validate_password(t["password[new]"]))?n["password[new]"]=s:Tumblr.settings_validators.equals(t["password[new]"],t["password[confirm]"])||(n["password[confirm]"]="Passwords don't match.")),t.errors&&(n.server=t.errors),!e.isEmpty(n))return n},validate_password:function(t){var e;return Tumblr.settings_validators.is_blank(t)&&(e="Password is empty."),e}});i.AccountSettingsModel=o}(jQuery,_,Tumblr),/*! scripts/settings/models/dashboard_model.js */
function(t,e,i){var o=Tumblr.SettingsModel.extend({defaults:e.extend({},Tumblr.SettingsModel.prototype.defaults,{page:"dashboard"})});i.DashboardSettingsModel=o}(jQuery,_,Tumblr),function(t,e,i,o){var s=i.Model.extend({defaults:{limit:20,offset:0},initialize:function(t){t=t||{},this.tumblelog=t.tumblelog,this.set("offset",this.defaults.offset,{silent:!0})},load:function(i){i=i||{};var o=t.ajax({url:"/svc/block",type:"GET",data:{form_key:t("#tumblr_form_key").attr("content"),tumblelog:this.tumblelog,offset:i.offset||this.get("offset"),limit:i.limit||this.defaults.limit}});return o.then(e.bind(this._afterLoad,this)),o},_afterLoad:function(t){this.set("offset",t.response.next_offset)},unblock:function(t){t=new Tumblr.Prima.Models.Tumblelog({name:t});var e=t.unblock();return e},block:function(t){t=new Tumblr.Prima.Models.Tumblelog({name:t});var e=t.block();return e}});o.BlockedBlogsModel=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/models/notifications_model.js */
function(t,e,i){var o=Tumblr.SettingsModel.extend({defaults:e.extend({},Tumblr.SettingsModel.prototype.defaults,{page:"notifications"})});i.NotificationsSettingsModel=o}(jQuery,_,Tumblr),/*! scripts/settings/models/apps_model.js */
function(t,e,i){var o=Tumblr.SettingsModel.extend({defaults:e.extend({},Tumblr.SettingsModel.prototype.defaults,{page:"app"}),validate:function(t){if(t.errors)return t.errors},revoke_app:function(e){var i=!1;return t.ajax("/oauth/revoke",{type:"POST",data:{consumer_id:e},withFormKey:!0,async:!1}).success(function(){i=!0}),i}});i.AppsSettingsModel=o}(jQuery,_,Tumblr),/*! scripts/settings/models/labs_model.js */
function(t,e,i){var o=Tumblr.SettingsModel.extend({defaults:e.extend({},Tumblr.SettingsModel.prototype.defaults,{page:"labs"})});i.LabsSettingsModel=o}(jQuery,_,Tumblr),/*! scripts/settings/models/tumblelog_model.js */
function(t,e,i){var o=Tumblr.SettingsModel.extend({defaults:e.extend({},Tumblr.SettingsModel.prototype.defaults,{page:"tumblelog"}),validate:function(t){var i={};if(e.isUndefined(t["tumblelog[name]"])||(Tumblr.settings_validators.is_blank(t["tumblelog[name]"])?i["tumblelog[name]"]="Username is blank.":Tumblr.settings_validators.range(t["tumblelog[name]"],1,32)?Tumblr.settings_validators.pattern(t["tumblelog[name]"],"^-|-$")&&(i["tumblelog[name]"]="Can't do dashes at the start or end. Middles only."):i["tumblelog[name]"]="Username is too long. Please enter 32 or fewer characters."),!e.isEmpty(i))return i},check_cname:function(e,i){return t.ajax({url:"/svc/settings/check_domain",type:"POST",data:{tumblelog_name_or_id:e,domain_name:i},withFormKey:!0,success:t.proxy(function(t,e,i){var o=i.getResponseHeader("X-tumblr-cname");"error"===o?this.set("tumblelog_invalid_cname",!0):this.unset("tumblelog_invalid_cname")},this)})}});i.TumblelogSettingsModel=o}(jQuery,_,Tumblr),/*! scripts/settings/models/tfa_model.js */
function(t,e,i,o){"use strict";var s=i.Model.extend({url:"/settings/tfa/save",defaults:{form_key:t("#tumblr_form_key").attr("content"),secure_form_key:t('input[name="secure_form_key"]').val()},_validateOptions:function(){var e=t("#tfa_user_auto_sms"),i=t("#tfa_user_has_totp_gen");if(0!==e.length&&0!==i.length)return this.get("isEnabling")?void t('[name="user[tfa_enabled]"]').prop("checked",!0):e.prop("checked")||i.prop("checked")||this.get("tfa_user[has_totp_gen]")||this.get("tfa_user[auto_sms]")?void t('[name="user[tfa_enabled]"]').prop("checked",!0):void Tumblr.Events.trigger("TwoFactorAuth:optionsValidationNotice")},initialize:function(){this.defaults=e.extend({},this.attributes,this.defaults),this.is_authenticated=!1,this.listenTo(Tumblr.Events,"TwoFactorAuth:validateOptions",this._validateOptions,this)},validate:function(t){var i,o={};if(!e.isUndefined(t["tfa[password]"])&&(i=this.validate_password(t["tfa[password]"]))&&(o["tfa[password]"]=i),e.isUndefined(t["tfa[phone]"])||Tumblr.settings_validators.min_length(t["tfa[phone]"],2)||(o["tfa[phone]"]="Phone number is too short"),!e.isEmpty(o))return o},validate_password:function(t){var e;return Tumblr.settings_validators.is_blank(t)&&(e="Password is empty."),e},save:function(t,o){o=o||{},this.has("tfa[password]")&&(t=e.extend({},e.pick(this.attributes,"tfa[password]"),t)),this.has("tfa[form_key]")&&(t=e.extend({},t,e.pick(this.attributes,"tfa[form_key]"))),o.contentType="application/json",o.data=JSON.stringify(e.extend({},this.defaults,t)),o.withFormKey=!0,i.Model.prototype.save.call(this,t,o)},parse:function(t,i){var o=e.omit(t,["meta","response"]),s=JSON.parse(i.data);return e.isUndefined(t.response.tfa_form_key)||(o["tfa[form_key]"]=t.response.tfa_form_key),e.isUndefined(t.response.tfa_number)||(o.tfa_number=t.response.tfa_number),e.isUndefined(t.response.mobile_otp)||(o.mobile_otp=t.response.mobile_otp),e.isUndefined(t.response.backup_codes)||(o.backup_codes=t.response.backup_codes),!this.is_authenticated&&s["tfa[password]"]&&(this.is_authenticated=!0),o}});o.TFAModel=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/password_placeholders.js */
function(t,e,i,o){var s=i.View.extend({el:"body",events:{"keydown.password_placeholders .password_wrapper .password_field":"on_keydown","blur.password_placeholders .password_wrapper .password_field":"on_blur"},initialize:function(t){this.options=e.extend({},this.defaults,t)},on_keydown:function(e){var i=t(e.currentTarget),o=i.parent().find(".password_placeholder");o.length&&(o.hide(),i.off("keydown.password_placeholders"))},on_blur:function(e){var i=t(e.currentTarget),o=i.parent().find(".password_placeholder");o.length&&!i.val()&&(o.show(),i.on("keydown.password_placeholders",t.proxy(this.on_keydown,this)))}});o.PasswordPlaceholders=s}(jQuery,_,Backbone,Tumblr),function(t,e,i,o,s){var n=o.SettingsAccordionToggle.extend({el:"#blocked_blogs",defaults:{alreadyBlockedConfirmation:"Looks like you are already blocking %s. Want to unblock that blog?",unblockText:"Unblock",errorText:"Oops, something went wrong."},events:{"click .accordion_trigger":"_onEditClick","click .block-button":"_onBlockClick","click .stop-blocking":"_onUnblockClick","click .show-more":"_onShowMoreClick","keydown input":"_onInputKeydown"},initialize:function(i){this.CanvasTools=o.Prima.Utils.CanvasTools,this.options=e.merge({},this.defaults,i),i.tumblelog&&(this.template=e.template(t("#blocked_blogs_template").html()),this.model=new o.BlockedBlogsModel({tumblelog:i.tumblelog}),this._cacheSelectors(),this.CanvasTools.drawPixelatedImages(this),this._addEventListeners(),o.SettingsAccordionToggle.prototype.initialize.call(this,this.options))},_cacheSelectors:function(){this.$blogsList=this.$el.find(".blogs"),this.$blockInputContainer=this.$el.find(".block-input"),this.$blockInput=this.$blockInputContainer.find("input"),this.$blockButton=this.$blockInputContainer.find(".block-button"),this.$triggerWrapper=this.$el.find(".accordion_trigger_wrapper"),this.$showMore=this.$el.find(".show-more")},_addEventListeners:function(){this.listenTo(this.model,"change:offset",function(t,e){this.$showMore.toggle(e!==-1)},this)},_onEditClick:function(t){t.preventDefault(),this._fetchBlogs()},_onShowMoreClick:function(t){t.preventDefault(),this._fetchBlogs()},_onBlockClick:function(t){t.preventDefault(),this._addBlock()},_onInputKeydown:function(t){if(13===t.which)return t.preventDefault(),this._addBlock(),!1},_addBlock:function(){var t=this.$blockInput.val().trim().toLowerCase();t&&this._block(t)},_onUnblockClick:function(e){e.preventDefault();var i=t(e.currentTarget),o=i.parent(".blog").data("tumblelog");o&&(i.addClass("loading"),this._unblock(o))},_fetchBlogs:function(){this.$trigger.addClass("loading");var t=this.model.load();t.then(e.bind(this._onFetchBlogsSuccess,this))},_onFetchBlogsSuccess:function(t){this.is_open||this._show(),this._logEvent("Kraken:blocks:blocklist:more_loaded",{offset:this.model.offset}),this.$blogsList.append(this.template(t.response)),this.CanvasTools.drawPixelatedImages(this)},_show:function(){!this.is_open&&this.$content.length&&(this.$trigger.removeClass("loading").addClass("hide"),this.$triggerWrapper.hide(),this.$content.addClass("show"),this.is_open=!0,this.enable_inputs(),this._logEvent("Kraken:blocks:blocklist:opened"),this.$("#ignore").focus())},_block:function(t){if(t){this.$blockButton.addClass("loading"),this.$blockInput.attr("disabled",!0);var i=this.model.block(t);i.then(e.bind(this._onBlockSuccess,this),e.bind(this._onBlockError,this))}},_onBlockSuccess:function(t){if(this.$blockButton.removeClass("loading"),this.$blockInput.attr("disabled",!1).val(""),this.$blockInput.removeClass("error"),t&&t.response){var s=t.response;if(s.already_blocked){var n=i(this.options.alreadyBlockedConfirmation,s.name),r=this.options.unblockText;o.Prima.Dialog.confirm(n,e.noop,e.bind(function(){this._unblock(s.name)},this),null,r),this._logEvent("Kraken:blocks:block_added:block_already_exists",{from:"settings"})}else this.$blogsList.prepend(this.template({tumblelogs:[s]})),this.model.offset=this.model.offset+1,this.CanvasTools.drawPixelatedImages(this),this._logEvent("Kraken:blocks:block_added",{from:"settings"})}},_onBlockError:function(){this.$blockButton.removeClass("loading"),this.$blockInput.attr("disabled",!1),this.$blockInput.addClass("error"),o.Events.trigger("block:error",{block:this.options.errorText})},_unblock:function(t){if(t){var i=this.model.unblock(t);i.then(e.bind(this._onUnblockSuccess(t),this))}},_onUnblockSuccess:function(t){return e.bind(function(){this.$blogsList.find('[data-tumblelog="'+t+'"]').remove(),this.model.offset=this.model.offset-1,this._logEvent("Kraken:blocks:block_removed",{from:"settings"})},this)},_logEvent:function(t,e){t&&o.Prima.Events&&o.Prima.Events.trigger(t,{loggingData:e||{}})},_onReportSuccess:function(t){return e.bind(function(){var e=t.parent(".report"),i=t.data("success");e.length&&i&&e.html(i)},this)}});s.BlockedBlogs=n}(window.jQuery,window._,window.sprintf,window.Tumblr,window.Tumblr),/*! scripts/settings/views/tfa_view.js */
function(t,e,i,o){"use strict";var s=Tumblr.SettingsAccordionBase.extend({events:{"change #user_tfa_enabled":"__change_user_tfa_enabled","input #tfa_password":"__authenticate_password_input","click .edit_tfa_options":"__click_edit_options",'click .open_tfa input[type="checkbox"]':"_updateTFAOptionsText"},subviews:{},__change_user_tfa_enabled:function(e){var i=t(e.currentTarget);i.is(":checked")?this.show():this.is_enabled?(i.prop("checked",!0),this.confirm_disable_tfa()):this.reset(),Tumblr.Events.trigger("TwoFactorAuth:updateOptionsText")},__authenticate_password_input:function(e){var i=t(e.currentTarget),o=i.closest(".tfa_authenticate").find(".accordion_save");o.length&&o.attr("disabled",!i.val())},__click_edit_options:function(){this.open_tfa()},_updateTFAOptionsText:function(){var e=t("#tfa_user_auto_sms"),i=t("#tfa_user_has_totp_gen"),o=t("#tfa_settings_enabled");if(0!==e.length&&0!==i.length){if(!e.prop("checked")&&!i.prop("checked"))return void o.hide("slow");o.show("slow");var s="";e.prop("checked")&&i.prop("checked")?s="via SMS and authenticator app":e.prop("checked")?s="via SMS":i.prop("checked")&&(s="via authenticator app"),o.text(s)}},initialize:function(e){Tumblr.SettingsAccordionBase.prototype.initialize.call(this,e),this.is_enabled=!1,this.$body=t("body"),this.$toggle=this.$("#user_tfa_enabled"),this.$content=this.$(".accordion_content"),this.$edit_options=this.$(".tfa_edit_wrapper"),this.$edit_options_button=this.$(".edit_tfa_options"),this.$mobile_password_content=this.$(".mobile_password_content"),this.$backup_codes_content=this.$(".backup_codes_content"),this.$current_number=this.$("#tfa_current_number"),this.listenTo(this.model,"change:tfa_number",this.update_number),this.listenTo(Tumblr.Events,"TwoFactorAuth:updateOptionsText",this._updateTFAOptionsText,this),this.$toggle.is(":checked")?(this.enable_tfa_complete(),this.show(!0)):this.enable_tfa()},enable_tfa:function(){this.stopListening(this.model,"sync"),this.subviews.enable_tfa=new Tumblr.EnableTFAView({model:this.model,on_cancel:e.bind(this.enable_tfa_cancel,this)}),this.$content.html(this.subviews.enable_tfa.render().el),this.model.set("isEnabling",!0),this.listenToOnce(this.model,"sync",this.option_enable_tfa)},enable_tfa_cancel:function(){this.cancel_view(this.subviews.enable_tfa),this.reset()},option_enable_tfa:function(){this.stopListening(this.model,"sync"),0===t(".option_enable_tfa").length?this.open_tfa():(this.subviews.option_enable_tfa=new Tumblr.OptionEnableTFAView({model:this.model,on_sms:e.bind(this.confirm_enable_sms,this,!1),on_cancel:e.bind(this.option_enable_cancel,this),on_complete:e.bind(this.enable_tfa_complete,this,!0)}),this.$content.html(this.subviews.option_enable_tfa.render().el))},option_enable_cancel:function(){this.cancel_view(this.subviews.option_enable_tfa),this.model.set("isEnabling",!1),this.reset()},confirm_enable_sms:function(t){this.stopListening(this.model,"sync"),this.subviews.confirm_enable_sms=new Tumblr.ConfirmEnableSMSView({on_cancel:e.bind(this.confirm_enable_sms_cancel,this,t)}),this.$content.html(this.subviews.confirm_enable_sms.render().el),t?this.listenToOnce(this.model,"sync",e.bind(this.open_tfa,this,"sms")):this.listenToOnce(this.model,"sync",e.bind(this.enable_tfa_complete,this,!0))},confirm_enable_sms_cancel:function(t){this.cancel_view(this.subviews.confirm_enable_sms),this.model.set("tfa_user[auto_sms]",!1),t?(this.open_tfa(),Tumblr.Events.trigger("TwoFactorAuth:updateOptionsText")):this.option_enable_tfa()},enable_tfa_complete:function(t){this.$edit_options.show(),this.is_enabled=!0,this.generate_mobile_password(),this.generate_backup_codes(),this.model.get("isEnabling")&&this.model.set("isEnabling",!1),t&&location.reload(!0)},open_tfa:function(t){switch(this.stopListening(this.model,"sync"),this.subviews.open_tfa=new Tumblr.OpenTFAView({model:this.model,edit_button:this.$edit_options_button,qr_payload:this.options.tfa_qr_payload,on_sms:e.bind(this.confirm_enable_sms,this,!1),on_cancel:e.bind(this.open_tfa_cancel,this),on_complete:e.bind(this.enable_tfa_complete,this,this.model.get("isEnabling"))}),this.$content.html(this.subviews.open_tfa.render().el),t){case"sms":this.model.set("tfa_user[auto_sms]","on"),this.$content.find("#tfa_user_auto_sms").prop("checked",!0);break;case"totp":this.model.set("tfa_user[has_totp_gen]","on"),this.$content.find("#tfa_user_has_totp_gen").prop("checked",!0)}},open_tfa_cancel:function(){this.cancel_view(this.subviews.open_tfa)},confirm_disable_tfa:function(){this.stopListening(this.model,"sync"),this.is_enabled?(this.subviews.confirm_disable_tfa=new Tumblr.ConfirmDisableTFAView({model:this.model,on_cancel:e.bind(this.confirm_disable_tfa_cancel,this)}),this.$content.prepend(this.subviews.confirm_disable_tfa.render().el),this.listenToOnce(this.model,"sync",this.disable_tfa)):this.disable_tfa()},confirm_disable_tfa_cancel:function(){this.cancel_view(this.subviews.confirm_disable_tfa)},disable_tfa:function(){this.is_enabled&&(this.$edit_options.hide(),this.$current_number.text(""),this.reset())},update_number:function(){this.$current_number.text(this.model.get("tfa_number"))},cancel_view:function(t){this.stopListening(this.model,"sync"),t&&t.remove()},reset:function(){this.stopListening(this.model,"sync"),this.$toggle.prop("checked",!1),this.is_enabled=!1,this.hide(),e.each(this.subviews,function(t){t.remove()}),this.enable_tfa()},generate_mobile_password:function(){this.subviews.mobile_password_tfa=new Tumblr.MobilePasswordTFAView({model:this.model}),this.$mobile_password_content.html(this.subviews.mobile_password_tfa.render().el)},generate_backup_codes:function(){this.subviews.backup_codes_tfa=new Tumblr.BackupCodesTFAView({model:this.model}),this.$backup_codes_content.html(this.subviews.backup_codes_tfa.render().el)}});o.TFAView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tfa_open_view.js */
function(t,e,i,o,s){"use strict";var n=Tumblr.SettingsAccordionBase.extend({className:"enable_tfa open_tfa",events:{'click .tfa_authenticate button[type="submit"]':"__click_authenticate_save","click .tfa_authenticate .accordion_cancel":"__click_authenticate_cancel","keydown #tfa_password":"__keydown_authenticate","change .tfa_authenticator_app .accordion_trigger":"__change_accordion_totp",'click .tfa_authenticator_app .totp_send button[type="submit"]':"__click_totp_save","click .tfa_authenticator_app .accordion_cancel":"__click_totp_cancel",'click .disable_totp button[type="submit"]':"__click_totp_disable","change #tfa_user_auto_sms.accordion_trigger":"__change_accordion_sms","change .flat_select select":"__select_change","click .tfa_auto_sms .accordion_cancel":"__click_sms_accordion_cancel",'click .tfa_auto_sms .sms_send button[type="submit"]':"__click_sms_send",'click .disable_sms button[type="submit"]':"__click_sms_disable","keydown #tfa_phone":"__textbox_enter_key","keydown #tfa_token":"__textbox_enter_key"},__click_authenticate_save:function(){this.toggle_submit_loader(!0)},__click_authenticate_cancel:function(){this.on_cancel()},__keydown_authenticate:function(t){13===t.which&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t))},__click_totp_save:function(){this.toggle_submit_loader(!0),this.listenToOnce(this.model,"sync",e.bind(this.save_totp,this))},__click_disable_totp:function(t){this.toggle_submit_loader(!0),this.listenToOnce(this.model,"sync",e.bind(this.disable_totp,this))},__click_totp_cancel:function(){this.reset_authenticator(),this.hide()},__change_accordion_sms:function(e){this.stopListening(this.model,"sync");var i=t(e.currentTarget);this.hide(),i.is(":checked")?(this.$content=this.$("#sms_accordion"),this.show()):(this.$content=this.$("#sms_accordion"),this.confirm_disable_sms()),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},__select_change:function(e){var i=t(e.currentTarget);this.update_country_code(i.val())},__click_sms_send:function(){this.toggle_submit_loader(!0),this.send_sms()},__click_sms_disable:function(t){this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t)},__click_sms_accordion_cancel:function(){this.$("#tfa_user_auto_sms.accordion_trigger").prop("checked",!1),this.hide(),Tumblr.Events.trigger("TwoFactorAuth:updateOptionsText"),this.toggle_sync()},__change_accordion_totp:function(e){this.stopListening(this.model,"sync");var i=t(e.currentTarget);this.hide(),i.is(":checked")?(this.render_qr(),this.$content=this.$("#totp_accordion"),this.show()):(this.$content=this.$("#totp_accordion"),this.confirm_disable_authenticator()),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},__textbox_enter_key:function(t){13===t.which&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t),"tfa_phone"===t.currentTarget.id?this.send_sms():this.listenToOnce(this.model,"sync",e.bind(this.save_totp,this)))},_updateTFAOptionsText:function(){Tumblr.Events.trigger("TwoFactorAuth:updateOptionsText")},initialize:function(i){this.options=e.extend({delay_init:!0,edit_button:null,on_cancel:t.noop},i||{}),this.confirm_disable_view=null,this.on_cancel=i.on_cancel,this.on_sms=this.options.on_sms||t.noop,this.on_complete=i.on_complete,this.default_template=e.template(t("#tfa_open_template").html()),this.authenticate_template=e.template(t("#tfa_authenticate_template").html()),this.disable_totp_template=e.template(t("#tfa_disable_totp_template").html()),this.disable_sms_template=e.template(t("#tfa_disable_sms_template").html()),this.$body=t("body"),this.$edit_button=t(i.edit_button),this.$phone_number=t("#tfa_current_number"),this.toggle_mobile(),this.listenTo(this.model,"invalid error",e.bind(function(){this.toggle_submit_loader(!1)},this)),this.model.is_authenticated?(this.$edit_button.hide(),this.template=this.default_template):(this.listenToOnce(this.model,"sync",this.authenticated),this.template=this.authenticate_template,this.$body.addClass("accordion_open")),Tumblr.SettingsAccordionBase.prototype.initialize.call(this,i)},authenticated:function(){this.$body.removeClass("accordion_open"),this.$edit_button.hide(),this.template=this.default_template,this.render()},remove:function(){return this.$body.removeClass("accordion_open"),this.confirm_disable_view&&this.confirm_disable_view.remove(),this.hide(),i.View.prototype.remove.call(this),this},render:function(){return this.$el.html(this.template({})),this.$submit_btn=this.$('button[type="submit"]'),this.$sms_submit_btn=this.$('#sms_enable button[type="submit"]'),this.$country_prefix=this.$(".country_prefix"),this.$mobile_number_wrapper=this.$(".mobile_number_wrapper"),this.$mobile_number=this.$(".mobile_number_wrapper .text_field"),this.update_country_code(this.$(".flat_select select").val()),this.toggle_mobile(),this.init_accordion(),this.$totp_toggle=t("#tfa_user_has_totp_gen"),this.$sms_toggle=t("#tfa_user_auto_sms"),this.sms_enabled=this.$sms_toggle.is(":checked"),this.totp_enabled=this.$totp_toggle.is(":checked"),Tumblr.Events.trigger("TwoFactorAuth:validateOptions"),e.defer(e.bind(function(){this.$(":input:first").focus()},this)),this},render_qr:function(){var t={};t["tfa[step]"]="generate_totp_qrcode",this.model.save(t,{wait:!0,success:e.bind(function(t,e){this.model.set("totp_qr_code",!0);var i=e.response.totp_qrcode,s=o(10,"H");s.addData(i.replace(/[a-zA-Z]/g,function(t){return String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26)})),s.make(),this.$(".totp_img").html(s.createImgTag())},this)})},toggle_submit_loader:function(t){this.$submit_btn.toggleClass("loading",!!t)},confirm_disable_authenticator:function(){this.totp_enabled||this.model.get("tfa_user[has_totp_gen]")?(this.hide(),this.model.get("tfa_user[has_totp_gen]")||this.model.set("tfa_user[has_totp_gen]","on"),this.confirm_disable_totp_view=new Tumblr.ConfirmDisableTFAView({model:this.model,template:this.disable_totp_template,on_cancel:e.bind(this.disable_totp_cancel,this)}),this.$content.html(this.confirm_disable_totp_view.render().el),t("#totp_accordion").addClass("show"),this.listenToOnce(this.model,"sync",this.disable_totp)):this.hide()},disable_totp_cancel:function(){this.confirm_disable_totp_view.remove(),this.render(),this.toggle_sync()},disable_totp:function(){this.confirm_disable_totp_view.remove(),this.model.set("tfa_user[has_totp_gen]",!1),this.totp_enabled=!1,this.render(),this.toggle_sync()},reset_authenticator:function(){this.confirm_disable_totp&&this.confirm_disable_totp.remove(),this.model.set("tfa_user[has_totp_gen]",!1),this.totp_enabled=!1,this.toggle_sync()},save_totp:function(){this.totp_enabled=!0,this.hide(),"on"!==this.model.get("tfa_user[has_totp_gen]")&&this.model.set("tfa_user[has_totp_gen]","on"),this.model.get("isEnabling")===!0&&this.on_complete(),this.render(),this.toggle_sync()},confirm_disable_sms:function(){this.sms_enabled||this.model.get("tfa_user[auto_sms]")?(this.hide(),this.model.get("tfa_user[auto_sms]")||this.model.set("tfa_user[auto_sms]","on"),this.confirm_disable_sms_view=new Tumblr.ConfirmDisableTFAView({model:this.model,template:this.disable_sms_template,on_cancel:e.bind(this.disable_sms_cancel,this)}),this.$content.html(this.confirm_disable_sms_view.render().el),t("#sms_accordion").addClass("show"),this.listenToOnce(this.model,"sync",this.disable_sms)):this.hide()},disable_sms_cancel:function(){this.confirm_disable_sms_view.remove(),this.render(),this.toggle_sync()},disable_sms:function(){this.confirm_disable_sms_view.remove(),this.model.set("tfa_user[auto_sms]",!1),this.sms_enabled=!1,this.render(),this.toggle_sync(),this.toggle_mobile()},send_sms:function(){t("#tfa_user_has_totp_gen").is(":checked")&&this.model.set("tfa_user[has_totp_gen]","on"),this.listenToOnce(this.model,"sync",e.bind(this.on_sms,this,!0))},toggle_mobile:function(){var e=t("#tfa_current_number"),i=t("#tfa_user_auto_sms").prop("checked");i&&this.model.get("tfa_user[auto_sms]")!==!1?e&&e.show("slow"):(e.hide("slow"),e.text(""))},toggle_sync:function(){"on"===this.model.get("tfa_user[has_totp_gen]")?this.$totp_toggle.prop("checked",!0):this.model.get("tfa_user[has_totp_gen]")===!1&&this.$totp_toggle.prop("checked",!1),"on"===this.model.get("tfa_user[auto_sms]")?this.$sms_toggle.prop("checked",!0):this.model.get("tfa_user[auto_sms]")===!1&&this.$sms_toggle.prop("checked",!1),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},adjust_input:function(){0!==this.$mobile_number_wrapper.width()&&this.$mobile_number.css({width:this.$mobile_number.parent().width()-2*this.$country_prefix.outerWidth(!0)+"px"})},update_country_code:function(t){this.$country_prefix.text(t),this.adjust_input()}});s.OpenTFAView=n}(jQuery,_,Backbone,qrcode,Tumblr),/*! scripts/settings/views/tfa_enable_view.js */
function(t,e,i,o){"use strict";var s=i.View.extend({className:"enable_tfa",events:{'click button[type="submit"]':"__click_button","click .accordion_cancel":"__click_cancel_button","keydown #tfa_password":"__textbox_enter_key"},__click_cancel_button:function(){this.on_cancel()},__click_button:function(){this.toggle_submit_loader(!0)},__textbox_enter_key:function(t){13===t.which&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t))},initialize:function(i){this.options=e.extend({},this.defaults,i),this.template=e.template(t("#tfa_enable_template").html()),this.on_cancel=this.options.on_cancel||t.noop,this.model.on("invalid error",e.bind(function(){this.toggle_submit_loader(!1)},this),this)},render:function(){return this.$el.html(this.template({})),this.$submit_btn=this.$('button[type="submit"]'),this},toggle_submit_loader:function(t){t?this.$submit_btn.addClass("loading"):this.$submit_btn.removeClass("loading")}});o.EnableTFAView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tfa_mobile_password_view.js */
function(t,e,i,o){var s=i.View.extend({className:"mobile_password_tfa",events:{"click .generate_password":"__generate_password_click","click .new_password":"__new_password_click","click .tfa_authenticate .accordion_cancel":"__authenticate_cancel_click",'click .tfa_authenticate button[type="submit"]':"__authenticate_save_click","keydown #tfa_password":"__password_keydown"},__generate_password_click:function(){this.model.is_authenticated||(this.listenToOnce(this.model,"sync",this.authenticated),this.template=this.authenticate_template,this.$body.addClass("accordion_open"),this.render({step:"generate_mobile_otp"}))},__new_password_click:function(e){e.preventDefault();var i=t(e.currentTarget),o={};this.template=this.loading_template,this.render(),o["tfa[step]"]=i.data("step"),this.model.save(o,{wait:!0})},__authenticate_cancel_click:function(){this.template=this.default_template,this.render(),this.$body.removeClass("accordion_open")},__authenticate_save_click:function(){this.toggle_submit_loader(!0)},__password_keydown:function(t){13===t.keyCode&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t))},initialize:function(i){this.options=e.extend({},this.defaults,i),this.default_template=e.template(t("#tfa_mobile_password_template").html()),this.authenticate_template=e.template(t("#tfa_authenticate_template").html()),this.loading_template=e.template(t("#tfa_mobile_password_loading_template").html()),this.success_template=e.template(t("#tfa_mobile_password_success_template").html()),this.$body=t("body"),this.$submit_btn=null,this.listenTo(this.model,"change:mobile_otp",this.mobile_otp_change),this.listenTo(this.model,"invalid error",e.bind(function(){this.toggle_submit_loader(!1)},this)),this.template=this.default_template},authenticated:function(){this.$body.removeClass("accordion_open")},render:function(t){return this.$el.html(this.template(t||{})),this.$submit_btn=this.$('button[type="submit"]'),this.$(":input:first").focus(),this},mobile_otp_change:function(){this.template=this.success_template,this.render({mobile_otp:this.model.get("mobile_otp")}),this.$(".new_password").focus()},toggle_submit_loader:function(t){this.$submit_btn.toggleClass("loading",!!t)}});o.MobilePasswordTFAView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tfa_backup_codes_view.js */
function(t,e,i,o){var s=i.View.extend({className:"backup_codes_tfa",events:{"click .generate_backup_codes":"__generate_codes_click","click #print_codes_button":"__open_print_codes_window","click #generate_new_codes_button":"__new_codes_click","click .tfa_authenticate .accordion_cancel":"__authenticate_cancel_click",'click .tfa_authenticate button[type="submit"]':"__authenticate_save_click","keydown #tfa_password":"__password_keydown"},__generate_codes_click:function(){this.model.is_authenticated||(this.listenToOnce(this.model,"sync",this.authenticated),this.template=this.authenticate_template,this.$body.addClass("accordion_open"),this.render({step:"generate_backup_codes"}))},__new_codes_click:function(e){e.preventDefault();var i=t(e.currentTarget),o={};this.template=this.loading_template,this.render(),o["tfa[step]"]=i.data("step"),this.model.save(o,{wait:!0})},__authenticate_cancel_click:function(){this.template=this.default_template,this.render(),this.$body.removeClass("accordion_open")},__authenticate_save_click:function(){this.toggle_submit_loader(!0)},__password_keydown:function(t){13===t.keyCode&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t))},__open_print_codes_window:function(t){t.preventDefault();var e=window.open("","TumblrBackupCodesPrintView"),i=this.print_template({backup_codes:this.model.get("backup_codes")});e.document.write(i),e.focus(),setTimeout(function(){e.print()},500)},initialize:function(i){this.options=e.extend({},this.defaults,i),this.default_template=e.template(t("#tfa_backup_codes_template").html()),this.authenticate_template=e.template(t("#tfa_authenticate_template").html()),this.loading_template=e.template(t("#tfa_backup_codes_loading_template").html()),this.success_template=e.template(t("#tfa_backup_codes_success_template").html()),this.print_template=e.template(t("#tfa_backup_codes_print_template").html()),this.$body=t("body"),this.$submit_btn=null,this.listenTo(this.model,"change:backup_codes",this.backup_codes_change),this.listenTo(this.model,"invalid error",e.bind(function(){this.toggle_submit_loader(!1)},this)),this.template=this.default_template},authenticated:function(){this.$body.removeClass("accordion_open")},render:function(t){return this.$el.html(this.template(t||{})),this.$submit_btn=this.$('button[type="submit"]'),this.$(":input:first").focus(),this},backup_codes_change:function(){this.template=this.success_template,this.render({backup_codes:this.model.get("backup_codes")}),this.$(".new_codes").focus()},toggle_submit_loader:function(t){this.$submit_btn.toggleClass("loading",!!t)}});o.BackupCodesTFAView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tfa_confirm_enable_view.js */
function(t,e,i,o){"use strict";var s=i.View.extend({className:"confirm_enable_tfa",events:{"input #tfa_token":"__input_token","click .accordion_cancel":"__click_cancel_button",'click button[type="submit"]':"__click_button","keydown #tfa_token":"__textbox_enter_key"},__input_token:function(e){var i=t(e.currentTarget);6===i.val().length?(this.form_enabled=!0,this.toggle_submit()):(this.form_enabled=!1,this.toggle_submit())},__textbox_enter_key:function(t){13===t.which&&this.form_enabled&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t),Tumblr.Events.trigger("TwoFactorAuth:updateOptionsText"))},__click_cancel_button:function(){this.on_cancel()},__click_button:function(){this.toggle_submit_loader(!0),Tumblr.Events.trigger("TwoFactorAuth:updateOptionsText")},initialize:function(i){this.options=e.extend({},this.defaults,i),this.template=e.template(t("#tfa_confirm_enable_template").html()),this.on_cancel=this.options.on_cancel||t.noop},render:function(){return this.$el.html(this.template({})),this.$submit_btn=this.$('button[type="submit"]'),this},toggle_submit:function(){this.form_enabled?this.$submit_btn.attr("disabled",!1):this.$submit_btn.attr("disabled",!0)},toggle_submit_loader:function(t){t&&this.form_enabled?this.$submit_btn.addClass("loading"):this.$submit_btn.removeClass("loading")}});o.ConfirmEnableSMSView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tfa_confirm_disable_view.js */
function(t,e,i,o){var s=i.View.extend({className:"disable_tfa",events:{"click .accordion_cancel":"__click_cancel_button",'click button[type="submit"]':"__click_submit_button","keydown #tfa_password":"__textbox_enter_key"},__click_cancel_button:function(){this.on_cancel(),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},__click_submit_button:function(){this.toggle_submit_loader(!0)},__textbox_enter_key:function(t){13===t.which&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t))},__focus_document:function(e){this.contains(t(e.currentTarget))||this.$first_input.focus()},initialize:function(i){this.options=e.extend({},this.defaults,i),this.template=this.options.template||e.template(t("#tfa_disable_confirmation_template").html()),this.on_cancel=this.options.on_cancel||t.noop,this.$body=t("body"),this.$doc=t(document),this.listenTo(this.model,"invalid error",e.bind(function(){this.toggle_submit_loader(!1)},this))},contains:function(t){return!!this.$el.has(t).length},remove:function(){return this.$doc.off(".disable_prompt"),this.$body.removeClass("accordion_open"),i.View.prototype.remove.call(this),this},render:function(){return this.$el.html(this.template({})),this.$submit_btn=this.$('button[type="submit"]'),this.$body.addClass("accordion_open"),this.$first_input=this.$(":input:first"),e.defer(e.bind(function(){this.$first_input.focus()},this)),this.$doc.on("focus.disable_prompt","a[href], button, select, input, textarea",e.bind(this.__focus_document,this)),this},toggle_submit_loader:function(t){this.$submit_btn.toggleClass("loading",!!t)}});o.ConfirmDisableTFAView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tfa_option_enable_view.js */
function(t,e,i,o,s){"use strict";var n=Tumblr.SettingsAccordionBase.extend({className:"enable_tfa option_enable_tfa",events:{"change #tfa_user_auto_sms.accordion_trigger":"__change_accordion_sms","change #tfa_user_has_totp_gen.accordion_trigger":"__change_accordion_totp","change .flat_select select":"__select_change",'click .tfa_authenticator_app button[type="submit"]':"__click_totp_save","click .mobile_number_wrapper":"__click_mobile_number_wrapper",'click .tfa_auto_sms button[type="submit"]':"__click_sms_send","click .accordion_cancel":"__click_cancel_button","keydown #tfa_phone":"__textbox_enter_key","keydown #tfa_token":"__textbox_enter_key"},__change_accordion_totp:function(e){this.stopListening(this.model,"sync");var i=t(e.currentTarget);i.is(":checked")?(this.hide(),this.render_qr(),this.$('[name="tfa_user[auto_sms]"]').prop("checked",!1),this.$content=this.$("#totp_enable"),this.show()):this.hide(),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},__change_accordion_sms:function(e){var i=t(e.currentTarget);i.is(":checked")?(this.hide(),this.$('[name="tfa_user[has_totp_gen]"]').prop("checked",!1),this.$content=this.$("#sms_enable"),this.show()):this.hide(),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},__click_totp_save:function(){this.toggle_submit_loader(!0),this.listenToOnce(this.model,"sync",e.bind(this.on_complete,this))},__click_sms_send:function(){this.toggle_submit_loader(!0),this.listenToOnce(this.model,"sync",e.bind(this.on_sms,this))},__select_change:function(e){var i=t(e.currentTarget);this.update_country_code(i.val())},__click_mobile_number_wrapper:function(){this.focus_mobile_number()},__click_cancel_button:function(){this.on_cancel()},__textbox_enter_key:function(t){13===t.which&&(this.toggle_submit_loader(!0),Tumblr.Events.trigger("settings:save_tfa",t),"tfa_phone"===t.currentTarget.id?this.listenToOnce(this.model,"sync",e.bind(this.on_sms,this)):this.listenToOnce(this.model,"sync",e.bind(this.on_complete,this)))},initialize:function(i){this.options=e.extend({},this["default"],i),this.template=e.template(t("#tfa_option_enable_template").html()),this.on_cancel=this.options.on_cancel||t.noop,this.on_sms=this.options.on_sms||t.noop,this.on_complete=this.options.on_complete||t.noop},render:function(){return this.$el.html(this.template({})),this.$country_prefix=this.$(".country_prefix"),this.$mobile_number_wrapper=this.$("mobile_number_wrapper"),this.$mobile_number=this.$(".mobilie_number_wrapper .text_field"),this.$submit_btn=this.$('button[type="submit"]'),this.update_country_code(this.$(".flat_select select").val()),this.$totp_wrapper=this.$(".tfa_totp"),this.$content=this.$("#totp_enable"),this.$("#tfa_user_auto_sms").prop("checked",!1),this.$("#tfa_user_has_totp_gen").prop("checked",!1),this},render_qr:function(){var t={};t["tfa[step]"]="generate_totp_qrcode",this.model.save(t,{wait:!0,success:e.bind(function(t,e){this.model.set("totp_qr_code",!0);var i=e.response.totp_qrcode,s=o(10,"H");s.addData(i.replace(/[a-zA-Z]/g,function(t){return String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26)})),s.make(),this.$(".totp_img").html(s.createImgTag())},this)})},focus_mobile_number:function(){this.$mobile_number.focus()},adjust_input:function(){0!==this.$mobile_number_wrapper.width()&&this.$mobile_number.css({width:this.$mobile_number.parent().width()-this.$country_prefix.outerWidth(!0)+"px"})},update_country_code:function(t){this.$country_prefix.text(t),this.adjust_input()},toggle_submit_loader:function(t){t?this.$submit_btn.addClass("loading"):this.$submit_btn.removeClass("loading")}});s.OptionEnableTFAView=n}(jQuery,_,Backbone,qrcode,Tumblr),/*! scripts/settings/views/tumblelog_header.js */
function(t,e,i,o){var s=Tumblr.SettingsAccordion.extend({el:"#tumblelog_header",events:function(){return e.extend({},Tumblr.SettingsAccordion.prototype.events,{"click .title.display_text":"on_title_click","click .description.display_text":"on_description_click"})},initialize:function(t){this.options=e.extend({},this.defaults,t),this.upload_url="/svc/post/upload_photo?source=tumblelog_header",this.$title=this.$(".title.display_text"),this.$title_input=this.$(".title.text_field"),this.$description=this.$(".description.display_text"),this.$description_input=this.$(".description.text_field"),this.$avatar=this.$(".avatar"),Tumblr.SettingsAccordion.prototype.initialize.call(this,this.options)},hide:function(){this.$title.text(this.$title_input.val()),this.$description.text(this.$description_input.val()),Tumblr.SettingsAccordion.prototype.hide.call(this)},on_title_click:function(){this.show();var t=this.$title_input.val();this.$title_input.focus(),this.$title_input.val(""),this.$title_input.val(t)},on_description_click:function(){this.show();var t=this.$description_input.val();this.$description_input.focus(),this.$description_input.val(""),this.$description_input.val(t)}});o.TumblelogHeader=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tumblelog_sharing_twitter.js */
function(t,e,i,o){"use strict";var s=window.l10n_str||{},n=i.View.extend({events:{"click .oauth_deauthorize_link":"oauth_deauthorize","click .oauth_authorize_link":"oauth_authorize"},initialize:function(t){this.options=t||{},this.tumblelog_name=this.model.get("tumblelog_name_or_id")},oauth_authorize:function(){window.open("/twitter/authorize?tumblelog="+this.tumblelog_name),setTimeout(e.bind(this.check_twitter,this),3e3)},oauth_authorized:function(t){t&&(this.model.set("twitter_username",t),this.$(".oauth_username").text(t),this.$el.addClass("is_oauthed"))},oauth_deauthorize:function(t){t.preventDefault(),this.$el.removeClass("is_oauthed"),this.deauthorize_twitter()},oauth_deauthorized:function(){this.model.set("twitter_username",null)},oauth_error:function(){Tumblr.Dialog.alert(s.ajax_error)},oauth_check:function(){this.model.get("twitter_username")||setTimeout(e.bind(this.check_twitter,this),3e3)},check_twitter:function(){t.ajax({url:"/twitter/check/"+this.tumblelog_name,type:"GET",success:e.bind(this.oauth_authorized,this),error:e.bind(this.oauth_error,this),complete:e.bind(this.oauth_check,this)})},deauthorize_twitter:function(){t.ajax({url:"/twitter/deauthorize/"+this.tumblelog_name,type:"POST",withFormKey:!0,success:e.bind(this.oauth_deauthorized,this),error:e.bind(this.oauth_error,this)})}});o.TumblelogTwitterSharing=n}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/export_blog.js */
function(t,e,i,o){var s=Tumblr.SettingsAccordionBase.extend({el:"#export_blog",events:{"click .export_button":"_onExportClick"},initialize:function(i){this.constructor.__super__.initialize.call(this,this.options),this.options=i||{},this.blogName=t("#tumblelog_name").val();var o=t.ajax({url:"/settings/check_export_status",type:"POST",withFormKey:!0,data:{blog_name:this.blogName}});t(".exportblog_btn").append(" "+t("#tumblelog_name").val());var s=this;o.done(function(i){var o=i.response.status;e.isEmpty(o)?t(".exportblog_btn").addClass("show"):"pending"===o?(t(".backup_text").addClass("show"),i.response.prev_backup_download_link&&i.response.prev_backup_date&&s.showDownloadBackup(i.response.prev_backup_date,i.response.prev_backup_download_link)):"complete"===o&&(i.response.download_link&&i.response.date&&s.showDownloadBackup(i.response.date,i.response.download_link),t(".exportblog_btn").addClass("show"))})},showDownloadBackup:function(e,i){t(".downloadexport_btn").addClass("show"),t(".download_date").text(e),t(".downloadexport_btn").attr("href",i)},_onExportClick:function(e){e.preventDefault();var i=t.ajax({url:"/settings/run_export",type:"POST",withFormKey:!0,data:{blog_name:this.blogName}});i.done(function(e){t(".exportblog_btn").css("display","none"),t(".backup_text").addClass("show")})}});o.ExportBlog=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/settings_view.js */
function(t,e,i,o){var s=i.View.extend({el:"#settings_form",error_tag_template:'<div class="error_tag hide" data-field="<%= field_name %>"></div>',error_message_template:'<ul class="messages errors"><% _.each(errors, function(error) { %><li><%= error %></li><% }); %></ul>',subviews:{},events:{"change [data-auto-save]":"__form_change","submit form":"__form_submit",'click [type="submit"]':"__submit_click","input .error":"__input_error","click #tumblelog_self_adult":"__logAdultBlog","click #user_safe_mode":"__logSafeMode"},__logAdultBlog:function(e){var i=t(e.currentTarget).is(":checked"),o={enabled:i,blogName:this.model.get("tumblelog_name_or_id")};this.model.get("is_safemode_enabled")&&Tumblr.Events.trigger("Kraken:safeMode:BlogFlaggedAdultByUser",{loggingData:o})},__logSafeMode:function(e){var i=t(e.currentTarget).is(":checked"),o={enabled:i};this.model.get("is_safemode_enabled")&&Tumblr.Events.trigger("Kraken:safeMode:SafeModeToggled",{loggingData:o})},__input_error:function(e){var i=t(e.currentTarget);this.remove_error_tag(i)},__form_change:function(e){var i=t(e.currentTarget),o=i.closest(".settings_group"),s=i.prop("tagName").toLowerCase(),n=i.offset();"input"!==s&&"textarea"!==s||(n.top+=3),this.save(o,!0,n)},__submit_click:function(e){e.preventDefault();var i=t(e.currentTarget),o=i.closest(".settings_group");this.$save_group=i.closest(".button_wrapper"),this.save(o)},__form_submit:function(t){t.preventDefault()},__required_by_field_input:function(){var e=t(this);e.fadeIn(150)},__required_by_field_blur:function(e){var i=t(this);t(e.currentTarget).val()||(i.hide(),i.find(".preference").val(""))},__required_by_field_click:function(){var e=t(this);e.fadeIn(150)},__required_by_field_change:function(e){var i=t(this);e.currentTarget.checked?i.show():i.hide()},__ignore_error:function(t){this.display_validation_errors(!1,t)},__block_error:function(t){this.display_validation_errors(!1,t)},__settings_accordion_hide:function(){this.remove_error_tags(),this.remove_error_messages()},__settings_accordion_toggle_hide:function(t){var i=this.serialize(t);e.isUndefined(i)||e.isEmpty(i)||this.model.save(i,{wait:!0})},_showTfaOptionsValidationNotice:function(){fieldName="user[tfa_enabled]",$field=this.$('[name="'+fieldName+'"]'),$field.prop("checked",!1),$container=$field.closest(".setting"),errorMsg="Please select one TFA option to keep TFA enabled.",this.display_error_tag($container,errorMsg,$field,fieldName)},initialize:function(t){this.options=t||{},this.options.notification_duration=this.options.notification_duration||1e3,this.cache_selectors(),this.init_accordions(),this.init_required_by_fields(),new Tumblr.Prima.FlatSelect,new Tumblr.PasswordPlaceholders({el:this.$el}),this.model.on("invalid",function(t,e){this.display_validation_errors(t,e,!0)},this),this.model.on("sync",this.sync_success,this),this.model.on("error",this.sync_error,this),this.listenTo(Tumblr.Events,"ignore:error",this.__ignore_error,this),this.listenTo(Tumblr.Events,"block:error",this.__block_error,this),this.listenTo(Tumblr.Events,"SettingsAccordion:hide",this.__settings_accordion_hide,this),this.listenTo(Tumblr.Events,"SettingsAccordionToggle:hide",this.__settings_accordion_toggle_hide,this),this.listenTo(Tumblr.Events,"TwoFactorAuth:optionsValidationNotice",this._showTfaOptionsValidationNotice,this),this.set_left_column_height(),this.tumblelog_tooltips=new Tumblr.Prima.ToolTip({selector:"#right_column .tumblelog_icon",class_name:"settings_tooltip",placement:"up"})},query_string_params:function(){for(var t,e=/\+/g,i=/([^&=]+)=?([^&]*)/g,o=function(t){return decodeURIComponent(t.replace(e," "))},s=window.location.search.substring(1),n={};null!==(t=i.exec(s));)n[o(t[1])]=o(t[2]);return n},set_left_column_height:function(){this.$el.css({"min-height":t("#right_column").height()+"px"})},cache_selectors:function(){this.$form=this.$("form")},init_accordions:function(){this.subviews.accordions=[],this.$el.find(".settings_accordion").each(e.bind(function(e,i){var o=t(i);o.hasClass("settings_accordion_toggle")?new Tumblr.SettingsAccordionToggle({el:o}):this.subviews.accordions.push(new Tumblr.SettingsAccordion({el:o}))},this))},init_required_by_fields:function(){var i=this.$el.find("*[data-required-by]").hide();i.each(e.bind(function(i,o){var s=t(o).attr("data-required-by"),n=this.$el.find(s);n.length&&("checkbox"===n.attr("type")?n.on("change.required_by",e.bind(this.__required_by_field_change,o)):"button"===n.attr("type")?n.on("click.required_by",e.bind(this.__required_by_field_click,o)):(n.on("input.required_by",e.bind(this.__required_by_field_input,o)),n.on("blur.required_by",e.bind(this.__required_by_field_blur,o))))},this))},__:function(t){return this.options.strings[t]||t},save:function(t,e,i){this.auto_saving=e,this.auto_save_offset=i;var o=this.serialize(t);this.model.save(o,{wait:!0})},serialize:function(i,o){var s;s=i&&i.length?i.find(":input"):this.$form;var n=s.serializeArray();t('input[type="checkbox"]:not(:checked)',i).each(function(){n.push({name:this.name,value:"off"})});var r=e.reduce(n,function(t,e){return t[e.name]=e.value,t},{});return o?JSON.stringify(r):r},display_inline_notification:function(i,o,s,n){clearTimeout(this.notification_timeout),s=s||"success";var r=this.$(".inline_notification."+s);r.length||(r=t("<div/>",{"class":"inline_notification "+s}),this.$form.after(r)),r.show().html(o).addClass("pre_animation"),r.css({top:i.top-this.$el.offset().top,right:i.right||25}),e.defer(function(){r.removeClass("pre_animation")}),this.notification_timeout=setTimeout(e.bind(this.hide_inline_notifications,this),n||1e3)},hide_inline_notifications:function(){this.$(".inline_notification").addClass("pre_animation")},display_error_tag:function(t,i,o,s){var n=this.$('.error_tag[data-field="'+s+'"]');return!!t.length&&(n.length||(n=this.create_error_tag(s),n.css({top:o.outerHeight()/2,left:o.outerWidth(!0)}),t.append(n)),n.show().text(i).addClass("pre_animation"),t.addClass("error"),void e.defer(function(){n.removeClass("pre_animation")}))},create_error_tag:function(i){var o=e.template(this.error_tag_template)({field_name:i}),s=t(o);return s},remove_error_tag:function(e){t(".error_tag",e).hide(),e.removeClass("error")},remove_error_tags:function(e){t(".error_tag",e).hide(),t(".setting",e).removeClass("error")},remove_error_messages:function(e){t(".errors.messages",e).remove()},stop_button_loaders:function(){this.$("button.loading").removeClass("loading")},display_validation_errors:function(t,i,o){this.remove_error_tags(),this.stop_button_loaders(),e.each(i,e.bind(function(t,e){var i=this.$('[name="'+e+'"]'),s=i.closest(".setting");o&&(t=this.__(t)),this.display_error_tag(s,t,i,e)},this))},display_error_messages:function(t){this.remove_error_messages();var i;e.isObject(t)?i=e.template(this.error_message_template)({errors:t}):(e.isString(t)||(t=this.__("Something went wrong.")),i=e.template(this.error_message_template)({errors:{error_msg:t}})),this.$save_group&&this.$save_group.length&&this.$save_group.after(i)},sync_success:function(){this.auto_saving&&this.auto_save_offset&&this.display_inline_notification(this.auto_save_offset,this.__("Saved")),this.remove_error_messages(),this.remove_error_tags(),this.stop_button_loaders(),Tumblr.SettingsAccordion.hide_all(),Tumblr.Events.trigger("SettingsView:sync:success"),Tumblr.Events.trigger("TwoFactorAuth:validateOptions")},sync_error:function(t,i){this.remove_error_messages(),this.remove_error_tags(),this.stop_button_loaders(),this.auto_saving&&this.auto_save_offset?this.display_inline_notification(this.auto_save_offset,this.__("Oops :("),"error"):i&&400===i.status&&i.responseJSON&&!e.isEmpty(i.responseJSON.response)?this.display_validation_errors(!1,i.responseJSON.response):this.display_error_messages(),Tumblr.Events.trigger("SettingsView:sync:error",t,i)}});o.SettingsView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/account_view.js */
function(t,e,i,o){var s=Tumblr.SettingsView.extend({events:function(){return e.defaults({"change .tfa_accordion [data-auto-save]":"__security_form_change",'click .tfa_accordion [type="submit"]':"__click_security_group","change #user_language":"__language_change","input #password_confirm":"__confirm_password_input","click [data-log-click]":"__logClick"},Tumblr.SettingsView.prototype.events)},__security_form_change:function(e){e.preventDefault(),e.stopImmediatePropagation();var i=t(e.currentTarget),o=i.closest(".settings_group"),s=i.offset();this.save_tfa(o,!0,s)},__click_security_group:function(e){e.preventDefault(),e.stopImmediatePropagation();var i=t(e.currentTarget),o=i.closest(".settings_group");this.save_tfa(o)},__language_change:function(){this.listenToOnce(this.model,"sync",t.proxy(function(){e.isFunction(window.location.reload)&&window.location.reload(!0)},this))},__confirm_password_input:function(){var t=this.$new_password.val(),e=this.$confirm_password.val();this.$confirm_password_parent.toggleClass("icon_checkmark",e&&t===e)},__logClick:function(e){var i=t(e.target).data("log-click");this.__logAction(i)},__logAction:function(t){var e={platform:this.model.attributes.is_mobile?"mobileWeb":"web",device:this.model.attributes.device};Tumblr.Events.trigger("Kraken:safeMode:"+t,{loggingData:e})},initialize:function(i){if(this.options=i||{},this.constructor.__super__.initialize.call(this,this.options),this.$new_password=this.$("#password_new"),this.$confirm_password=this.$("#password_confirm"),this.$confirm_password_parent=this.$confirm_password.closest(".password_wrapper"),this.password_meter=new Tumblr.PasswordStrengthMeter({password:"#password_new"}),this.tfa_model=new Tumblr.TFAModel,this.init_tfa(),this.tfa_model.on("invalid",this.display_validation_errors,this),this.tfa_model.on("sync",this.sync_success,this),this.tfa_model.on("error",this.sync_error,this),this.model.on("change:email[new]",this.email_update,this),this.model.on("change:password[new]",this.password_update,this),!e.isEmpty(params=this.query_string_params())&&params.show&&(accordion=Tumblr.SettingsAccordion.find_by_selector("#"+params.show))){accordion.show(!0);var o=t("#"+params.show);if(o.length){var s=o.closest(".settings_group");s.get(0).scrollIntoView(!0)}}this.listenTo(Tumblr.Events,"settings:save_tfa",this.__click_security_group,this)},init_tfa:function(){this.tfa_view=new Tumblr.TFAView({el:".tfa_accordion",tfa_qr_payload:this.options.tfa_qr_payload,model:this.tfa_model})},email_update:function(){var t=this.model.get("email[new]");this.$(".email_group .accordion_label").text(t),this.$('[name="email[new]"]').val(t).data("value",t)},password_update:function(){window.location=window.location.pathname},save_tfa:function(t,i,o){this.auto_saving=i,this.auto_save_offset=o;var s=e.extend({},this.serialize(t),{"tfa[step]":t.data("step")});this.tfa_model.save(s,{wait:!0})}});o.AccountSettingsView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/dashboard_view.js */
function(t,e){var i=Tumblr.SettingsView.extend({redpopSettingSelector:"#redpop",xkitDetectionSelector:"#xkit-notifications",maxRedpopSettingAttempts:10,redpopSettingAttempts:0,redpopSettingTimeout:1e3,initialize:function(t){this.options=t||{},this.initializeRedpopSetting(),this.constructor.__super__.initialize.call(this,this.options)},initializeRedpopSetting:function(){if(this.hasRedpopSetting())return Tumblr.Flags.bool("is_admin")?void this.showRedpopRampToggle():(this.redpopSettingAttempts+=1,this.redpopSettingAttempts>=this.maxRedpopSettingAttempts?void this.removeRedpopRampToggle():void(this.hasXKit()?this.showRedpopRampToggle():setTimeout(this.initializeRedpopSetting.bind(this),this.redpopSettingTimeout)))},hasXKit:function(){return jQuery(this.xkitDetectionSelector).length>0},hasRedpopSetting:function(){return jQuery(this.redpopSettingSelector).length>0},showRedpopRampToggle:function(){jQuery(this.redpopSettingSelector).show()},removeRedpopRampToggle:function(){jQuery(this.redpopSettingSelector).remove()}});e.DashboardSettingsView=i}(jQuery,Tumblr),/*! scripts/settings/views/notifications_view.js */
function(t,e,i){var o=Tumblr.SettingsView.extend({events:function(){return e.defaults({"click .tumblelog_save_for_all_toggle":"toggle_save_for_all"},Tumblr.SettingsView.prototype.events)},__submit_click:function(e){e.preventDefault();var i=t(e.currentTarget);i.addClass("loading");var o=i.closest(".settings_accordion");this.save(o)},_escape_reg_exp:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")},initialize:function(t){this.options=t||{};var i,o;this.constructor.__super__.initialize.call(this,this.options),!e.isEmpty(i=this.query_string_params())&&i.show_notification&&(o=Tumblr.SettingsAccordion.find_by_selector("#"+i.show_notification))&&(o.show(!0),document.getElementById(i.show_notification).scrollIntoView(!0)),this.listenTo(Tumblr.Events,"SettingsAccordion:hide",this.reset_save_button),this.listenTo(Tumblr.Events,"SettingsAccordion:show",this.reset_save_for_all)},sync_success:function(){this.model.get("save_all")?window.location.reload():(this.model.get("tumblelog[name_or_id]")&&!this.model.get("save_all")&&this.update_tumblelog_notifications(this.model.get("tumblelog[name_or_id]")),this.constructor.__super__.sync_success.call(this))},update_tumblelog_notifications:function(t){var e,i,o=this.model.toJSON(),s=0,n=0,r=new RegExp("\\["+this._escape_reg_exp(t)+"\\]$","i");for(var a in o)r.test(a)&&(/^email/.test(a)?(s++,"on"===o[a]&&n++):/^notifications/.test(a)&&(e=o[a]));i=0===n?0:n<s?1:2,this.options.summaries&&this.$("#"+t+" .summary").html(this.options.summaries[e][i])},toggle_save_for_all:function(e){var i=t(e.currentTarget),o=i.closest(".settings_accordion"),s=o.find(".accordion_save"),n=s.find(".label");i.is(":checked")?(this.model.set("save_all",!0),n.text(this.__("Save for all"))):(this.model.set("save_all",!1),n.text(this.__("Save")))},reset_save_for_all:function(){var e=t(".tumblelog_save_for_all_toggle");e.prop("checked",!1);var i=e.closest(".settings_accordion"),o=i.find(".accordion_save"),s=o.find(".label");o.removeClass("loading"),s.text(this.__("Save")),this.model.set("save_all",!1)},reset_save_button:function(){var t=this.$(".accordion_save");t.removeClass("loading")}});i.NotificationsSettingsView=o}(jQuery,_,Tumblr),/*! scripts/settings/views/apps_app_view.js */
function(t,e,i,o){var s=window.l10n_str||{},n=i.View.extend({events:{"click .app_remove_button":"app_remove","click .app_revoke_editable ":"app_remove_confirm","click .is_secret .app_consumer_label":"app_show_secret"},initialize:function(t){this.options=t||{},this.remove_text=this.options.remove_text,this.cancel_text=this.options.cancel_text,this.app_data=this.$el.data("json"),this.el.removeAttribute("data-json")},show_dialog:function(e,i){var s={text:e||"",type:"confirm",visible_glass:!0,templates:null,escape_button:0,buttons:{0:{text:this.cancel_text,close:!0,callback:t.noop},1:{text:this.remove_text,selected:!0,btn_class:"red",close:!0,callback:i||t.noop}}};o.Dialog.dialog(s)},app_remove:function(e){e.preventDefault(),this.show_dialog(t(e.currentTarget).data("message"),t.proxy(this.on_app_remove,this))},app_remove_confirm:function(e){e.preventDefault();var i=t(e.currentTarget);this.show_dialog(i.data("message"),function(){window.location=i.attr("href")})},on_app_remove:function(){this.model.revoke_app(this.app_data.id)?this.remove():o.Dialog.alert(s.ajax_error)},app_show_secret:function(e){var i=t(e.currentTarget);i.closest(".app_consumer").addClass("show_secret")}});o.AppsAppSettingsView=n}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/apps_view.js */
function(t,e,i,o){var s=Tumblr.SettingsView.extend({el:"#settings_actions_apps .left_column",initialize:function(t){this.options=t||{},this.constructor.__super__.initialize.call(this,this.options);var i,o;!e.isEmpty(i=this.query_string_params())&&i.show_app&&(o=Tumblr.SettingsAccordion.find_by_selector("#"+i.show_app))&&(o.show(!0),document.getElementById(i.show_app).scrollIntoView(!0)),this.apps=[],e.map(this.$(".app:not(.is_promo)"),e.bind(function(t){this.apps.push(new Tumblr.AppsAppSettingsView({model:this.model,el:t,remove_text:this.__("Remove"),cancel_text:this.__("Nevermind")}))},this))}});o.AppsSettingsView=s}(jQuery,_,Backbone,Tumblr),/*! scripts/settings/views/tumblelog_view.js */
function(t,e,i,o){var s=Tumblr.SettingsAccordion.extend({el:"#username_accordion",initialize:function(e){Tumblr.SettingsAccordion.prototype.initialize.call(this,e),this.on_hide=this.options.on_hide||t.noop},hide:function(t){this.on_hide(),Tumblr.SettingsAccordion.prototype.hide.call(this,t)}}),n=Tumblr.SettingsView.extend({events:function(){return e.defaults({"keydown #tumblelog_cname":"__cname_keydown","keyup #tumblelog_cname":"__cname_keyup",'click .username_group button[type="submit"]':"__submit_username_group","change #tumblelog_cname_enabled":"__change_cname_enabled","click #tumblelog_password_protected_checkbox":"__password_toggle",'change .submissions_group .accepted_types input[type="checkbox"]':"__submission_accepted_type_change","click .username_group .test_domain":"__test_domain_click","keydown #tumblelog_name":"__tumblelog_name_keydown","click #tumblelog_self_adult":"__tumblelog_self_adult_click"},Tumblr.SettingsView.prototype.events)},__tumblelog_self_adult_click:function(t){var e=t.currentTarget.checked;e?this.$("#tumblelog_hidden_from_search_results").prop({disabled:e,checked:e}):this.$("#tumblelog_hidden_from_search_results").prop({disabled:e})},__change_cname_enabled:function(e){e.preventDefault(),e.stopPropagation(),this.cname_toggle(t(e.currentTarget))},__submit_username_group:function(i){var o=t(i.currentTarget);this.model.get("tumblelog_invalid_cname")&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),Tumblr.Dialog.confirm(this.__("invalid cname"),e.bind(function(){var t=o.closest(".settings_group");this.save(t)},this),e.bind(function(){o.removeClass("loading"),this.$("#tumblelog_cname").focus()},this)))},__password_toggle:function(e){this.auto_saving=!1;var i=t(e.currentTarget),o=t(".social_group");i.is(":checked")?o.addClass("turn_opaque"):o.removeClass("turn_opaque")},__submission_accepted_type_change:function(e){if(this.$submission_types.filter(":checked").length<1){e.preventDefault(),e.stopPropagation(),t(e.currentTarget).prop("checked",!0);var i=this.$accepted_types.data("message");Tumblr.Dialog.alert(i)}},__cname_keydown:function(t){if(13===t.which)return t.preventDefault(),this.check_cname(),!1},__cname_keyup:function(){this.current_cname_val=this.$cname.val(),this.previous_cname_val=this.current_cname_val===this.previous_cname_val?this.current_cname_val:this.previous_cname_val,this.previous_cname_val!==this.current_cname_val&&this.reset_cname_state(),this.$save_btn.attr("disabled",!0)},__test_domain_click:function(t){t.preventDefault(),this.check_cname()},__cname_enabled_change:function(t,i){var o=this.tumblr_url;this.cname_enabled=i,"on"!==i||e.isUndefined(t.get("tumblelog[cname]"))||(o=t.get("tumblelog[cname]").replace("http://","")),o=o.replace("http://",""),this.$tumblelog_links.attr("href","http://"+o).text(o)},__tumblelog_name_keydown:function(t){this.$("#tumblelog_name_notice").show()},initialize:function(i){this.options=e.extend({},this.defaults,i),this.channel_name=this.options.channel_name,this.header_data=this.options.header_data,this.tumblr_url=this.options.tumblr_url,this.cname_enabled=this.options.cname_enabled_default,this.init_header(),this.username_accordion=new s({on_hide:t.proxy(this.on_username_accordion_hide,this)}),this.listenTo(this.model,"change:tumblelog[cname_enabled]",this.__cname_enabled_change),this.listenTo(this.model,"change:user[share_likes]",this.toggle_likes_url),this.listenTo(this.model,"change:user[share_following]",this.toggle_following_url),this.cache_selectors(),this.display_cname(),this.init_tumblelog_name(),this.init_twitter_sharing(),this.toggle_likes_url(),this.toggle_following_url(),Tumblr.SettingsView.prototype.initialize.call(this,this.options)},init_header:function(){this.header_view=new o.IndashBlog.HeaderView({el:this.$("#indash_header"),model:new o.IndashBlog.HeaderModel(this.header_data,{url:"/settings/save/header",tumblelog_name_or_id:this.model.get("tumblelog_name_or_id")}),show_navigation:!0,show_follow_button:!1,show_user_controls:!1,show_share_controls:!1,on_customize_open:function(){t("body").addClass("accordion_open")},on_customize_close:function(){t("body").removeClass("accordion_open")}}).render()},init_tumblelog_name:function(){this.model.set("initial_tumblelog_name",this.$tumblelog_name.val())},cache_selectors:function(){this.$tumblelog_name=this.$("#tumblelog_name"),this.$cname_wrapper=this.$(".cname_wrapper"),this.$cname_enabled=this.$("#tumblelog_cname_enabled"),this.$test_domain_link=this.$(".username_group .test_domain"),this.$cname=this.$("#tumblelog_cname"),this.$cname_errors=this.$(".cname_errors"),this.$password_protected=this.$("#tumblelog_password_protected"),this.$sharing_twitter=this.$(".oauth_group.is_twitter"),this.$accepted_types=this.$(".submissions_group .accepted_types"),this.$submission_types=this.$accepted_types.find('input[type="checkbox"]'),this.$tumblelog_links=this.$(".tumblelog_link"),this.$save_btn=this.$('.tumblelog_domain_buttons button[type="submit"]'),Tumblr.SettingsView.prototype.cache_selectors.call(this,this.options)},init_twitter_sharing:function(){this.sharing=this.sharing||{},this.sharing.twitter=new Tumblr.TumblelogTwitterSharing({el:this.$sharing_twitter.eq(0),model:this.model})},on_username_accordion_hide:function(){if(this.reset_cname_state(),this.$cname_enabled.get(0)){var t="on"===this.cname_enabled,e=this.$cname_enabled.get(0).checked;e!==t&&this.$cname_enabled.prop("checked",t).trigger("change")}},display_check_cname_notification:function(t){t=t||"error";var e={right:80,top:this.$cname.offset().top+1};this.display_inline_notification(e,this.$cname_wrapper.data(t),t+" icon",3e3)},check_cname:function(t){if(t=(t||this.$cname.val()).replace("http://",""),t&&t.indexOf(".")!==-1){this.reset_cname_state(),this.$test_domain_link.addClass("testing");var i=this.model.check_cname(this.channel_name,t);i.always(e.bind(function(){this.$test_domain_link.removeClass("testing")},this)),i.done(e.bind(this.render_cname_success,this)),i.error(e.bind(this.render_cname_errors,this))}},render_cname_success:function(){this.$cname_wrapper.addClass("is_ok"),this.$save_btn.attr("disabled",!1),this.display_check_cname_notification("success")},render_cname_errors:function(t){var i=e.keys(t.responseJSON.response);i.length?i.forEach(function(t){this.$cname_errors.find("."+t).addClass("show")}.bind(this)):this.$cname_errors.find(".generic_error").addClass("show"),this.$cname_errors.addClass("has_errors"),this.display_check_cname_notification("error")},reset_cname_state:function(){this.$cname_wrapper.removeClass("is_ok"),this.$cname_errors.removeClass("has_errors"),this.$cname_errors.find(".cname_error").removeClass("show"),this.hide_inline_notifications()},display_cname:function(){this.$cname_enabled.is(":checked")&&(this.reset_cname_state(),this.$cname_wrapper.addClass("show"))},cname_toggle:function(t){var i=t.data("confirm-message");t.is(":checked")?this.$cname_wrapper.addClass("show"):"on"===this.cname_enabled?Tumblr.Dialog.confirm(i,e.bind(function(){this.model.unset("tumblelog_invalid_cname"),this.$cname_wrapper.removeClass("show")},this),e.bind(function(){t.prop("checked",!0)},this)):this.$cname_wrapper.removeClass("show"),this.reset_cname_state(),this.$save_btn.attr("disabled",!!t.is(":checked"))},on_cname_enabled_change:function(t,i){var o=this.tumblr_url;"on"!==i||e.isUndefined(t.get("tumblelog[cname]"))||(o=t.get("tumblelog[cname]").replace("http://","")),o=o.replace("http://",""),this.$tumblelog_links.attr("href","http://"+o).text(o)},check_likes_enabled:function(){return this.$('[name="user[share_likes]"]').is(":checked")},toggle_likes_url:function(){this.check_likes_enabled()?this.$(".settings_group.share_likes").addClass("is_sharing"):this.$(".settings_group.share_likes.is_sharing").removeClass("is_sharing")},check_following_enabled:function(){return this.$('[name="user[share_following]"]').is(":checked")},toggle_following_url:function(){this.check_following_enabled()?this.$(".settings_group.share_following").addClass("is_sharing"):this.$(".settings_group.share_following.is_sharing").removeClass("is_sharing")},sync_success:function(){if(this.model.get("tumblelog[name]")&&this.model.get("initial_tumblelog_name")!==this.model.get("tumblelog[name]").toLowerCase()){var t=window.location.href.split("/").pop(),e=window.location.search,i=window.location.href.replace(t,this.model.get("tumblelog[name]")).toLowerCase()+e;window.location.replace(i)}else this.constructor.__super__.sync_success.call(this);this.reset_cname_state()}});o.UsernameAccordion=s,o.TumblelogSettingsView=n}(jQuery,_,Backbone,Tumblr);